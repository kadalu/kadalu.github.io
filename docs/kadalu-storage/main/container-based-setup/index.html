<!DOCTYPE HTML>
<html lang="en">
    <head>
        
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title> | Kadalu </title>
<link href="/static/css/fav.png" rel="icon" type="image/x-icon" />
<link rel="apple-touch-icon" href="/static/css/fav.png" />
<meta name="generator" content="Nanoc 4.12.1">
<meta property="og:title" content=""/>
<meta name="author" content=""/>
<meta property="og:locale" content="en_US"/>
<meta name="description" content=""/>
<meta property="og:description" content=""/>
<link rel="canonical" href="/docs/kadalu-storage/main/container-based-setup/"/>
<meta property="og:url" content="/docs/kadalu-storage/main/container-based-setup/"/>
<meta property="og:site_name" content="Kadalu"/>
<meta property="og:image" content=""/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content=""/>
<meta name="twitter:card" content="summary_large_image"/>
<meta property="twitter:image" content=""/>
<meta property="twitter:title" content=""/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <link rel="stylesheet" href="/static/css/stylesheet.css">
<link rel="stylesheet" href="/static/css/syntax-highlight-emacs.css">
<script defer data-domain="kadalu.github.io" src="https://plausible.io/js/plausible.js"></script>
<script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.8.2/dist/alpine.min.js" defer></script>

    </head>
    <body>
        

<div class="bg-indigo-900">
    <div class="w-full px-5  m-auto py-5">
        <div class="lg:grid lg:grid-cols-12" x-data="{ menuOpen : false }">
            <div class="col-span-4 lg:col-span-2" style="height:40px">
                <a href="/"><img src="/static/css/logo.png" class="h-10 float-left" /></a>
                <button @click="menuOpen = !menuOpen" class="block absolute md:hidden right-7 top-5 w-8 h-8 text-gray-200 p-1">
                    <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
                </button>
            </div>
            <div class="pt-2 col-span-8 lg:col-span-10">
                <nav class="absolute md:relative top-16 left-0 md:top-0 z-20 md:flex flex-col-reverse md:flex-row-reverse md:space-x-3 font-semibold w-full md:w-auto bg-indigo-900 shadow-md rounded-lg md:rounded-none md:shadow-none md:bg-transparent p-6 pt-5 md:p-0"
                     :class="{ 'flex' : menuOpen , 'hidden' : !menuOpen}"  @click.away="menuOpen = false"
                >
                    <a href="/blog" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Blog</a>
                    <a href="/opensource" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Open Source</a>
                    <a href="/docs" class="bg-gray-900 text-white py-2 px-3 rounded-md text-sm font-medium">Docs</a>
                </nav>
            </div>
        </div>
    </div>
</div>

        
        <div class="flex flex-col md:grid md:grid-cols-12 w-full" x-data="{docMenuOpen: false}">
            <div class="col-span-3 bg-gray-100" :class="{ 'block mr-10' : docMenuOpen , 'hidden md:block' : !docMenuOpen}" @click.away="docMenuOpen = false">
                <div class="py-5 px-5">
                    
                    <div class="p-5 bg-gray-200 border text-right rounded-lg">
                        <strong>Version: </strong>
                        <select class="input-field" onchange="location = '/docs/kadalu-storage/' + this.value;">
                            <option  value="latest">latest</option>
                            
                            <option selected value="main">main</option>
                            
                        </select>
                    </div>
                    
                    <h2 class="text-xl font-semibold mt-7">User Guide</h2>
                    <ul>
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/docs/kadalu-storage/main/quick-start/">Quick Start</a></li>
                        
                        
                        
                        
                        <li class="text-indigo-600 font-semibold py-2 md:py-0">Container Based Setup</li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/docs/kadalu-storage/main/introduction/">Introduction</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/docs/kadalu-storage/main/install/">Install</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/docs/kadalu-storage/main/user-management/">User Management</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/docs/kadalu-storage/main/config-snapshots/">Config Snapshots</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/docs/kadalu-storage/main/pools/">Pools</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/docs/kadalu-storage/main/volumes/">Volumes</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/docs/kadalu-storage/main/faqs/">FAQs</a></li>
                        
                        
                    </ul>
                    
                    
                    
                </div>
            </div>
            <div id="main" class="col-span-9">
                <div class="py-5 px-10">
                    
                    <div class="mb-10">
                        <span class="inline-block font-semibold text-gray-700 py-1 text-xl">
                            <a href="/">
                                <svg class="w-6 h-6 inline-block" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg></a> / <a href="/docs/kadalu-storage">kadalu-storage</a> / <a href="/docs/kadalu-storage/main">main</a> / container-based-setup/</span>
                    </div>
                    
                    <button @click="docMenuOpen = !docMenuOpen" class="block md:hidden w-8 h-8 text-gray-600 mb-5">
                        <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
                    </button>
                    <div class="mb-24 prose max-w-none prose-indigo">
                        <h1>Container based setup</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Kadalu Storage project is still under active development. It depends on the core parts of GlusterFS and built a new ecosystem around it. Many fixes are submitted to upstream GlusterFS to make it work with the Kadalu Storage manager, but unfortunately, the fixes are in devel branch but not yet part of the GlusterFS release. The Kadalu team plans to release the core GlusterFS packages with the Kadalu Storage package releases. Untill the Kadalu Storage packages are available for use, Containers are the best choice to try out and provide feedback to us about it.</p>
</div>
<div class="paragraph">
<p>Start the Storage node or Client as shown in the example below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo docker run -d                            \
    --network host                            \
    -v /root/kadalu/workdir:/var/lib/kadalu   \
    -v /root/kadalu/home:/root/.kadalu        \
    -v /ZP1/storage1:/ZP/storage1             \
    -v /sys/fs/cgroup/:/sys/fs/cgroup:ro      \
    --privileged                              \
    --name kadalu-$(hostname)                 \
    --hostname $(hostname)                    \
    kadalu/storage-node:latest</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_storage_units">Storage Units</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>..
    -v /ZP1/storage1:/ZP/storage1             \
..</pre>
</div>
</div>
<div class="paragraph">
<p>Pre create the file system(xfs/ext4/zfs) and expose the Storage while starting the Kadalu Storage container. Provide multiple Storage units per container/node as required. For example, the following code shows creating ZFS dataset and exposing that while starting the Storage node.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo zpool create ZP1 /dev/vda
sudo zfs create ZP1/storage1</pre>
</div>
</div>
<div class="paragraph">
<p>Storage from host are exposed to the Storage container.</p>
</div>
<div class="paragraph">
<p>Storage Units are available as Volumes inside container, use those to Create Kadalu Volumes.</p>
</div>
<div class="paragraph">
<p><strong>Note</strong>: This approach will not work in Mac based container setup since these Volumes are not exposed directly from the host machine.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_other_persistent_volumes">Other Persistent Volumes</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>..
    -v /root/kadalu/workdir:/var/lib/kadalu   \
    -v /root/kadalu/home:/root/.kadalu        \
..</pre>
</div>
</div>
<div class="paragraph">
<p>Along with Storage units a few other directories needs to be persisted.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/var/lib/kadalu</code> - If a Container becomes Mgr instance then it stores full Cluster configurations, else if it is Agent instance, it will contain the tokens that are required to communicate with Mgr instances.</p>
</li>
<li>
<p><code>/root/.kadalu</code> - This is optional, but good to have this persisted to avoid running login command every time on container restart.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_network_host">Network - Host</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>..
    --network host                            \
..</pre>
</div>
</div>
<div class="paragraph">
<p>Kadalu Storage nodes will communicate with each other, prefered to use Host network option while starting the Storage container. A few more fixes required to make the Storage manager to customize the Port. Once it gets that capability, possibly other network modes can be supported.</p>
</div>
<div class="paragraph">
<p><strong>Note</strong>: Since network=host option is in use, starting multiple Storage containers per node is not possible. Instead expose multiple Storage units per instance of Storage container.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_initialize">Initialize</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After starting all the Storage containers, login to any one container and create a User. Note that, first node where we create a user will become Manager. All other instances will become Agents.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>docker <span class="nb">exec</span> <span class="nt">-it</span> kadalu-<span class="si">$(</span><span class="nb">hostname</span><span class="si">)</span> /bin/bash
<span class="gp">#</span><span class="w"> </span>kadalu user create admin
<span class="go">Password:
User admin created successfully. Run `kadalu user login admin` to login
</span><span class="gp">#</span><span class="w"> </span>kadalu user login admin
<span class="go">Password:
Login successful. Details saved in `/root/.kadalu/session`. Delete this file or run `kadalu user logout` command to delete the session.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now create a Pool and add nodes(Container instances created as above) to that Pool.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># kadalu pool create DEV
# kadalu node add DEV/server1.example.com
# kadalu node add DEV/server2.example.com
# kadalu node add DEV/server3.example.com</pre>
</div>
</div>
<div class="paragraph">
<p>Create a Kadalu Volume using the Storages exported from the host.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># kadalu volume create DEV/vol1 mirror \
    server1.example.com:/ZP1/storage1/vol1 \
    server2.example.com:/ZP2/storage2/vol1 \
    server3.example.com:/ZP3/storage3/vol1</pre>
</div>
</div>
<div class="paragraph">
<p>Mount the Volume by logging into one of the Storage container or the Client container.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ sudo docker exec -it client1.example.com /bin/bash
# kadalu login admin
Password:
# mkdir /mnt/vol1
# mount -t kadalu server1.example.com:/DEV/vol1 /mnt/vol1</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_notes">Notes</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>No separate Client container image is available. Use the storage-node container itself for time being.</p>
</li>
<li>
<p>Container images are not yet optimized for size.</p>
</li>
</ul>
</div>
</div>
</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="bg-gray-800 text-gray-100 py-10">
    <div class="mx-auto w-full px-5 " style="min-height: 40vh">
        <div class="md:grid gap-2 md:grid-cols-4 md:gap-4">
            <div class="mb-10">
                <h2 class="text-xl font-semibold text-indigo-300">Community</h2>
                <ul>
                    <li><a href="/opensource">Open Source</a></li>
                    <li><a href="https://join.slack.com/t/kadalu/shared_invite/enQtNzg1ODQ0MDA5NTM2LWMzMTc5ZTJmMjk4MzI0YWVhOGFlZTJjZjY5MDNkZWI0Y2VjMDBlNzVkZmI1NWViN2U3MDNlNDJhNjE5OTBlOGU">Slack</a></li>
                    <li><a href="https://github.com/kadalu">Github</a></li>
                </ul>
            </div>

            <div class="mb-10">
                <h2 class="text-xl font-semibold text-indigo-300">Learn</h2>
                <ul>
                    <li><a href="/docs">Documentation</a></li>
                    <li><a href="/blog">Blog</a></li>
                    <li><a href="/faq">FAQ</a></li>
                    <li><a href="/rfcs">RFCs</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>
<div class="bg-gray-800 text-gray-100 py-10">
    <div class="mx-auto w-3/4 text-center text-gray-300 mb-10">
        &copy; 2022 Kadalu Community(https://github.com/kadalu). All Rights Reserved.
    </div>
</div>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-144588868-2"></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-144588868-2');
</script>


    </body>
</html>
