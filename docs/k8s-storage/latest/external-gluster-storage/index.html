<!DOCTYPE HTML>
<html lang="en">
    <head>
        
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title> | Kadalu </title>
<link href="/static/css/fav.png" rel="icon" type="image/x-icon" />
<link rel="apple-touch-icon" href="/static/css/fav.png" />
<meta name="generator" content="Nanoc 4.12.1">
<meta property="og:title" content=""/>
<meta name="author" content=""/>
<meta property="og:locale" content="en_US"/>
<meta name="description" content=""/>
<meta property="og:description" content=""/>
<link rel="canonical" href="/docs/k8s-storage/latest/external-gluster-storage/"/>
<meta property="og:url" content="/docs/k8s-storage/latest/external-gluster-storage/"/>
<meta property="og:site_name" content="Kadalu"/>
<meta property="og:image" content=""/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content=""/>
<meta name="twitter:card" content="summary_large_image"/>
<meta property="twitter:image" content=""/>
<meta property="twitter:title" content=""/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <link rel="stylesheet" href="/static/css/stylesheet.css">
<link rel="stylesheet" href="/static/css/syntax-highlight-emacs.css">
<script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.8.2/dist/alpine.min.js" defer></script>

    </head>
    <body>
        

<div class="bg-indigo-900">
    <div class="w-full px-5  m-auto py-5">
        <div class="lg:grid lg:grid-cols-12" x-data="{ menuOpen : false }">
            <div class="col-span-4 lg:col-span-2" style="height:40px">
                <a href="/"><img src="/static/css/logo.png" class="h-10 float-left" /></a>
                <button @click="menuOpen = !menuOpen" class="block absolute md:hidden right-7 top-5 w-8 h-8 text-gray-200 p-1">
                    <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
                </button>
            </div>
            <div class="pt-2 col-span-8 lg:col-span-10">
                <nav class="absolute md:relative top-16 left-0 md:top-0 z-20 md:flex flex-col-reverse md:flex-row-reverse md:space-x-3 font-semibold w-full md:w-auto bg-indigo-900 shadow-md rounded-lg md:rounded-none md:shadow-none md:bg-transparent p-6 pt-5 md:p-0"
                     :class="{ 'flex' : menuOpen , 'hidden' : !menuOpen}"  @click.away="menuOpen = false"
                >
                    <a href="/blog" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Blog</a>
                    <a href="/company" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Company</a>
                    <a href="/opensource" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Open Source</a>
                    <a href="/services" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Services</a>
                    <a href="/products" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Products</a>
                    <a href="/docs" class="bg-gray-900 text-white py-2 px-3 rounded-md text-sm font-medium">Docs</a>
                </nav>
            </div>
        </div>
    </div>
</div>

        
        <div class="flex flex-col md:grid md:grid-cols-12 w-full" x-data="{docMenuOpen: false}">
            <div class="col-span-3 bg-gray-100" :class="{ 'block mr-10' : docMenuOpen , 'hidden md:block' : !docMenuOpen}" @click.away="docMenuOpen = false">
                <div class="py-5 px-5">
                    
                    <div class="p-5 bg-gray-200 border text-right rounded-lg">
                        <strong>Version: </strong>
                        <select class="input-field" onchange="location = '/docs/k8s-storage/' + this.value;">
                            <option selected value="latest">latest</option>
                            
                            <option  value="devel">devel</option>
                            
                        </select>
                    </div>
                    
                    <h2 class="text-xl font-semibold mt-7">User Guide</h2>
                    <ul>
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/docs/k8s-storage/latest/quick-start/">Quick Start</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/docs/k8s-storage/latest/introduction/">Introduction</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/docs/k8s-storage/latest/setup/">Setup</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/docs/k8s-storage/latest/setup-storage/">Setup Storage</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/docs/k8s-storage/latest/csi-to-claim-persistent-volumes/">CSI to claim Persistent Volumes</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/docs/k8s-storage/latest/try-kadalu/">Try Kadalu</a></li>
                        
                        
                        
                        
                        <li class="text-indigo-600 font-semibold py-2 md:py-0">External Gluster Storage</li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/docs/k8s-storage/latest/storage-config-options/">Storage Config Options</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/docs/k8s-storage/latest/storage-classes/">Storage Classes</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/docs/k8s-storage/latest/troubleshooting/">Troubleshooting</a></li>
                        
                        
                    </ul>
                    
                    <h2 class="text-xl font-semibold mt-7">Use cases</h2>
                    <ul>
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/docs/k8s-storage/latest/running-a-webserver/">Running a Webserver</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/docs/k8s-storage/latest/running-minio/">Running Minio</a></li>
                        
                        
                    </ul>
                    
                    <h2 class="text-xl font-semibold mt-7">Articles</h2>
                    <ul>
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/docs/k8s-storage/latest/how-it-works?/">How it works?</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/docs/k8s-storage/latest/gluster-and-kadalu/">Gluster and Kadalu</a></li>
                        
                        
                    </ul>
                    
                    <h2 class="text-xl font-semibold mt-7">Developer Guide</h2>
                    <ul>
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/docs/k8s-storage/latest/get-involved/">Get Involved</a></li>
                        
                        
                    </ul>
                    
                    
                    
                </div>
            </div>
            <div id="main" class="col-span-9">
                <div class="py-5 px-10">
                    
                    <div class="mb-10">
                        <span class="inline-block font-semibold text-gray-700 py-1 text-xl">
                            <a href="/">
                                <svg class="w-6 h-6 inline-block" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg></a> / <a href="/docs/k8s-storage">k8s-storage</a> / <a href="/docs/k8s-storage/latest">latest</a> / external-gluster-storage/</span>
                    </div>
                    
                    <button @click="docMenuOpen = !docMenuOpen" class="block md:hidden w-8 h-8 text-gray-600 mb-5">
                        <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
                    </button>
                    <div class="mb-24 prose max-w-none prose-indigo">
                        <h1>Use external gluster volume as PV in kadalu</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>You can still use kadalu even when you have your storage nodes outside
of the kubernetes (k8s) cluster. We describe this <code>kind</code> of setup as
'External'. Such a description is intended to indicate that the storage
server processes are not managed by kadalu operator.</p>
</div>
<div class="paragraph">
<p>In both the ways please note <code>metadata.name</code> (let&#8217;s say <code>e-vol</code>) in
<code>kind: KadaluStorage</code> will create a StorageClass with name
<code>kadalu.&lt;volname&gt;</code> (<code>volname</code> will be replaces with <code>e-vol</code>).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_external_gluster_in_kadalu_native_way">Using external gluster in kadalu native way</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this mode, we expect gluster volume to be created and is in 'Started' state.
kadalu storage config takes one of the node IP/hostname, and gluster volume name
to use it as the storage for PVs. The PVs would be provided as subdirectories -
this is similar to how a PV is created in kadalu native way.</p>
</div>
<div class="paragraph">
<p>In order for resources.requests.storage requests to be honored please read <a href="https://github.com/kadalu/kadalu/tree/latest/server/README.md">the server documentation</a>.</p>
</div>
<div class="paragraph">
<p>The best example for this is, what we use in our CI. Checkout this
sample yaml file</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># file: external-config.yaml</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kadalu-operator.storage/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">KadaluStorage</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ext-config</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">External</span>
  <span class="c1"># Omitting 'kadalu_format' or using 'native' as a value will create</span>
  <span class="c1"># 1 PV : 1 Subdir in external gluster volume</span>
  <span class="na">kadalu_format</span><span class="pi">:</span> <span class="s">native</span>
  <span class="na">details</span><span class="pi">:</span>
    <span class="c1"># gluster_hosts: [ gluster1.kadalu.io, gluster2.kadalu.io ]</span>
    <span class="na">gluster_host</span><span class="pi">:</span> <span class="s">gluster1.kadalu.io</span>
    <span class="na">gluster_volname</span><span class="pi">:</span> <span class="s">kadalu</span>
    <span class="na">gluster_options</span><span class="pi">:</span> <span class="s">log-level=DEBUG</span>

<span class="c1"># file: pvc-from-external-gluster.yaml</span>
<span class="nn">---</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PersistentVolumeClaim</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">pv-ext-kadalu</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="c1"># Add 'kadalu.' to name from KadaluStorage kind</span>
  <span class="na">storageClassName</span><span class="pi">:</span> <span class="s">kadalu.ext-config</span>
  <span class="na">accessModes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">ReadWriteMany</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">requests</span><span class="pi">:</span>
      <span class="c1"># This needs to be set using 'kadalu-quotad'</span>
      <span class="na">storage</span><span class="pi">:</span> <span class="s">500Mi</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Please edit 'gluster_host' and 'gluster_volname' parameters in config section.</p>
</div>
<div class="paragraph">
<p>You can also setup the external storage through our <code>kubectl kadalu</code> CLI.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>kubectl kadalu storage-add store-name <span class="nt">--external</span> gluster.kadalu.io:/kadalu</code></pre>
</div>
</div>
<div class="paragraph">
<p>After this, just use <code>kadalu.store-name</code> (note that 'store-name' is
name used for <code>storage-add</code>) in PVC yaml, like below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>...
spec:
  storageClassName: kadalu.store-name
  ...</pre>
</div>
</div>
<div class="paragraph">
<p>Note that, if you have an existing gluster setup inside the k8s cluster, you can
treat that also as 'External' and use kadalu to manage it. In this case, you
will need to provide the pre-created gluster volume name for the config.</p>
</div>
<div class="sect2">
<h3 id="_using_glusterfs_directory_quota_to_set_capacity_limitation_for_external_gluster_volumes">Using GlusterFS directory quota to set capacity limitation for external gluster volumes</h3>
<div class="paragraph">
<p>kadalu native way does not support distributed volumes on the external gluster. You could execute the following commands before installation to enable kadalu to achieve PV capacity limitation using the Gluster directory Quota.</p>
</div>
<div class="paragraph">
<p>Please make sure you have enabled quota for external gluster volume before deploying kadalu</p>
</div>
<hr>
<div class="paragraph">
<p>gluster volume quota &lt;volname&gt; enable
---</p>
</div>
<div class="paragraph">
<p>Create namespace in advance for using Secret</p>
</div>
<div class="listingblock">
<div class="content">
<pre>kubectl create namespace kadalu</pre>
</div>
</div>
<div class="paragraph">
<p>Specify the username and secret key of the external Gluster node in Secret for Quota setting.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>kubectl create secret generic glusterquota-ssh-secret --from-literal=glusterquota-ssh-username=&lt;username&gt; --from-file=ssh-privatekey=&lt;ssh_privatekey_path&gt; -n kadalu</pre>
</div>
</div>
<div class="paragraph">
<p>Then install as usual</p>
</div>
<div class="listingblock">
<div class="content">
<pre> kubectl kadalu install</pre>
</div>
</div>
<div class="paragraph">
<p>kadalu sets GlusterFS directory quota to the subdirectories assigned to PVs on the external gluster. kadalu connects to the server via ssh by using the secret key and username of the external gluster in K8s Secret.</p>
</div>
<div class="paragraph">
<p>If you use this configuration, you do not need to install kadalu-quotad to the external gluster server.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_external_storage_directly">Using external storage directly</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this mode, 1 Gluster Volume would be 1 PV. Something very similar to how heketi
project allocates PVs. We don&#8217;t encourage using this mode, nor recommend it in a
new setup. This mode is provided just as an option for those who are consuming
gluster volumes in this mode. This helps to use the PVs used in other deployments
to be still consumed.</p>
</div>
<div class="paragraph">
<p>You&#8217;ll be needing something similar to below config to use whole gluster
volume as a single PV</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># file: external-gluster-as-pv.yaml</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kadalu-operator.storage/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">KadaluStorage</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">pv-ext</span> <span class="c1"># Keep changing the name for different volumes</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">External</span>
  <span class="c1"># Setting 'kadalu_format' as 'non-native' is important</span>
  <span class="na">kadalu_format</span><span class="pi">:</span> <span class="s">non-native</span>          <span class="c1"># Will map 1 Gluster Volume : 1 PV</span>
  <span class="na">details</span><span class="pi">:</span>
    <span class="na">gluster_host</span><span class="pi">:</span> <span class="s">gluster1.kadalu.io</span>   <span class="c1"># Change to your gluster host</span>
    <span class="na">gluster_volname</span><span class="pi">:</span> <span class="s">test</span>              <span class="c1"># Change to existing gluster volume</span>
    <span class="na">gluster_options</span><span class="pi">:</span> <span class="s">log-level=DEBUG</span>   <span class="c1"># Comma separated options</span>

<span class="nn">---</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PersistentVolumeClaim</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">pv-ext</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">storageClassName</span><span class="pi">:</span> <span class="s">kadalu.pv-ext</span>
  <span class="na">accessModes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">ReadWriteMany</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">requests</span><span class="pi">:</span>
      <span class="na">storage</span><span class="pi">:</span> <span class="s">200Mi</span> <span class="c1"># This gets ignored in this case.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Please edit <code>gluster_host</code> and <code>gluster_volname</code> parameters in Storage Class.</p>
</div>
<div class="paragraph">
<p>Then run <code>kubectl apply -f ./external-gluster-as-pv.yaml</code></p>
</div>
<div class="paragraph">
<p>Note that in this mode, there would be as many 'StorageClass' as number of PVs, but
that is not avoidable at present because we can&#8217;t pass user driven input from PV claim
yaml.</p>
</div>
</div>
</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="bg-gray-800 text-gray-100 py-10">
    <div class="mx-auto w-full px-5 " style="min-height: 40vh">
        <div class="md:grid gap-2 md:grid-cols-4 md:gap-4">
            <div class="mb-10">
                <h2 class="text-xl font-semibold text-indigo-300">Kadalu</h2>
                <ul>
                    <li><a href="/products#k8s-native-storage">Kubernetes native Storage</a></li>
                    <li><a href="/products#kadalu-storage">Kadalu Storage</a></li>
                    <li><a href="/products#glusterup">GlusterFS monitoring</a></li>
                    <li><a href="/services">Services</a></li>
                    <li><a href="/services#features">Feature development</a></li>
                    <li><a href="/services#upgrade">Upgrade assistance</a></li>
                    <li><a href="/services#consultancy">Consultancy</a></li>
                    <li><a href="/security">Security</a></li>
                </ul>
            </div>

            <div class="mb-10">
                <h2 class="text-xl font-semibold text-indigo-300">Community</h2>
                <ul>
                    <li><a href="/opensource">Open Source</a></li>
                    <li><a href="https://join.slack.com/t/kadalu/shared_invite/enQtNzg1ODQ0MDA5NTM2LWMzMTc5ZTJmMjk4MzI0YWVhOGFlZTJjZjY5MDNkZWI0Y2VjMDBlNzVkZmI1NWViN2U3MDNlNDJhNjE5OTBlOGU">Slack</a></li>
                    <li><a href="https://github.com/kadalu">Github</a></li>
                    <!-- <li><a href="/office-hours">Office Hours</a></li> -->
                </ul>
            </div>

            <div class="mb-10">
                <h2 class="text-xl font-semibold text-indigo-300">Learn</h2>
                <ul>
                    <li><a href="/docs">Documentation</a></li>
                    <li><a href="/blog">Blog</a></li>
                    <li><a href="/faq">FAQ</a></li>
                    <li><a href="/rfcs">RFCs</a></li>
                    <!-- <li><a href="/compare">Compare</a></li> -->
                </ul>
            </div>

            <div class="mb-10">
                <h2 class="text-xl font-semibold text-indigo-300">Company</h2>
                <ul>
                    <li><a href="/company">About</a></li>
                    <li><a href="/contact">Contact</a></li>
                    <li><a href="/sitemap.xml">Sitemap</a></li>
                </ul>

                <h2 class="text-xl font-semibold text-indigo-300 mt-10">Write to us</h2>
                <ul>
                    <li><a href="mailto:hello@kadalu.io"><svg class="w-4 h-4 inline-block mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path></svg>hello@kadalu.io</a></li>
                </ul>

                <h2 class="text-xl font-semibold text-indigo-300 mt-10">Follow Us</h2>
                <ul>
                    <li><a href="https://twitter.com/kadaluio">Twitter</a></li>
                    <li><a href="https://linkedin.com/company/kadalu-io">Linkedin</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>
<div class="bg-gray-800 text-gray-100 py-10">
    <div class="mx-auto w-3/4 text-center text-gray-300 mb-10">
        &copy; 2021 Kadalu Software Private Limited. All Rights Reserved.
    </div>
</div>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-144588868-2"></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-144588868-2');
</script>


    </body>
</html>
