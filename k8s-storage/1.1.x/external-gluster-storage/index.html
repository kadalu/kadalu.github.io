

<!DOCTYPE HTML>
<html lang="en">
    <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charSet="utf-8"/>
    <title></title>
    <link rel="stylesheet" href="/static/css/bulma-0.9.4.min.css">
    <link rel="stylesheet" href="/static/css/stylesheet.css">
    <link rel="stylesheet" href="/static/css/syntax-highlight-emacs.css">
    <script defer src="/static/alpinejs.persist-3.10.5.min.js"></script>
    <script defer src="/static/alpinejs-3.10.5.min.js"></script>

    <meta name="generator" content="Nanoc 4.12.1">
    
<link href="/favicon.ico" rel="icon" type="image/x-icon" />
<link rel="apple-touch-icon" href="/favicon.ico" />
<meta name="generator" content="Nanoc 4.12.1">
<meta property="og:title" content=""/>
<meta name="author" content=""/>
<meta property="og:locale" content="en_US"/>
<meta name="description" content=""/>
<meta property="og:description" content=""/>
<link rel="canonical" href="/k8s-storage/1.1.x/external-gluster-storage/"/>
<meta property="og:url" content="/k8s-storage/1.1.x/external-gluster-storage/"/>
<meta property="og:site_name" content="Kadalu"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content=""/>

<meta name="twitter:card" content="summary"/>
<meta name="twitter:image" content="https://kadalu.tech/images/logo-icon-spaced.png"/>
<meta property="og:image" content="https://kadalu.tech/images/logo-icon-spaced.png"/>

<meta name="twitter:site" content="https://kadalu.tech"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content=""/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />


    <script defer data-domain="docs.kadalu.tech" src="https://plausible.io/js/script.js"></script>
</head>

    <body>
        <div id="main" x-data="{version: '1.1.x', menuShow: true}">
            <nav class="navbar pr-4" role="navigation" aria-label="main navigation" x-data="{showing: false}">
    <div class="navbar-brand has-text-left">
        <a class="navbar-item" href="/">
            <span class="has-text-primary is-size-4">kadalu</span><span class="has-text-grey is-size-4 ml-1">DOCS</span>
        </a>

        <!-- <div class="field">
             <p class="control has-icons-left mx-2 mt-4">
             <input class="input" type="text" placeholder="Search">
             <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="icon is-small is-left pl-1" style="width: 1.5em">
             <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd" />
             </svg>
             </p>
             </div> -->

        <a role="button" class="navbar-burger" aria-label="menu" :class="showing ? 'is-active' : ''" aria-expanded="false" @click="showing = !showing">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        
    </div>

    <div class="navbar-end" x-show="showing">
        <a class="navbar-item" href="https://kadalu.tech">
            kadalu.tech
        </a>
    </div>
    <div class="navbar-end is-hidden-touch">
        <a class="navbar-item" href="https://kadalu.tech">
            kadalu.tech
        </a>
    </div>
</nav>

            <div class="tabs is-small mb-0">
                <ul>
                    
                    <li class="">
                        <a href="/kadalu-storage/latest" class="mb-0">
                            <span>Kadalu Storage</span>
                        </a>
                    </li>
                    
                    <li class="is-active">
                        <a href="/k8s-storage/latest" class="mb-0">
                            <span>Kadalu Storage (Kubernetes Native)</span>
                        </a>
                    </li>
                    
                    <li class="">
                        <a href="/console/latest" class="mb-0">
                            <span>Kadalu Storage Console</span>
                        </a>
                    </li>
                    
                    <li class="">
                        <a href="/binnacle/latest" class="mb-0">
                            <span>Binnacle</span>
                        </a>
                    </li>
                    
                </ul>
            </div>
            <div class="is-flex" x-data="{menuShow: $persist(true), headings: document.getElementsByClassName('heading')}">
                <div class="is-flex-grow-0 is-flex-shrink-0 has-background-info-light" style="overflow-x: hidden;transition: all 200ms ease-in-out;" :style="{'flex-basis': menuShow ? '230px' : '0'}">
                    <aside class="menu mb-4" :class="menuShow ? 'px-4' : 'px-6'">
                        
                        <p class="menu-label mt-4">
                            User Guide
                        </p>
                        <ul class="menu-list">
                            
                            
                            <li class=""><a class="" href="/k8s-storage/1.1.x/quick-start/">Quick Start</a></li>
                            
                            
                            <li class=""><a class="" href="/k8s-storage/1.1.x/quick-start-yaml/">Quick Start YAML</a></li>
                            
                            
                            <li class=""><a class="" href="/k8s-storage/1.1.x/introduction/">Introduction</a></li>
                            
                            
                            <li class=""><a class="" href="/k8s-storage/1.1.x/setup/">Setup</a></li>
                            
                            
                            <li class=""><a class="" href="/k8s-storage/1.1.x/using-with-private-container-registry/">Using with Private Container Registry</a></li>
                            
                            
                            <li class=""><a class="" href="/k8s-storage/1.1.x/setup-storage/">Setup Storage</a></li>
                            
                            
                            <li class=""><a class="" href="/k8s-storage/1.1.x/csi-to-claim-persistent-volumes/">CSI to claim Persistent Volumes</a></li>
                            
                            
                            <li class=""><a class="" href="/k8s-storage/1.1.x/try-kadalu/">Try Kadalu</a></li>
                            
                            
                            <li class=""><a class="is-active" href="/k8s-storage/1.1.x/external-gluster-storage/">External Gluster Storage</a></li>
                            
                            
                            <li class=""><a class="" href="/k8s-storage/1.1.x/storage-config-options/">Storage Config Options</a></li>
                            
                            
                            <li class=""><a class="" href="/k8s-storage/1.1.x/block-volume/">Block Volume</a></li>
                            
                            
                            <li class=""><a class="" href="/k8s-storage/1.1.x/storage-classes/">Storage Classes</a></li>
                            
                            
                            <li class=""><a class="" href="/k8s-storage/1.1.x/troubleshooting/">Troubleshooting</a></li>
                            
                        </ul>
                        
                        <p class="menu-label mt-4">
                            Use cases
                        </p>
                        <ul class="menu-list">
                            
                            
                            <li class=""><a class="" href="/k8s-storage/1.1.x/running-a-webserver/">Running a Webserver</a></li>
                            
                            
                            <li class=""><a class="" href="/k8s-storage/1.1.x/running-minio/">Running Minio</a></li>
                            
                        </ul>
                        
                        <p class="menu-label mt-4">
                            Articles
                        </p>
                        <ul class="menu-list">
                            
                            
                            <li class=""><a class="" href="/k8s-storage/1.1.x/how-it-works?/">How it works?</a></li>
                            
                            
                            <li class=""><a class="" href="/k8s-storage/1.1.x/gluster-and-kadalu/">Gluster and Kadalu</a></li>
                            
                        </ul>
                        
                        <p class="menu-label mt-4">
                            Developer Guide
                        </p>
                        <ul class="menu-list">
                            
                            
                            <li class=""><a class="" href="/k8s-storage/1.1.x/get-involved/">Get Involved</a></li>
                            
                        </ul>
                        
                    </aside>
                </div>
                <div class="is-flex-grow-0 is-flex-shrink-0 has-background-info-light has-text-right" style="flex-basis: 20px; position:relative" @click="menuShow = !menuShow">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" x-show="menuShow" class="icon is-clickable" style="position: sticky; top:2px">
                        <path fill-rule="evenodd" d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z" clip-rule="evenodd" />
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" x-show="!menuShow" class="icon is-clickable" style="position: sticky; top:2px">
                        <path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd" />
                    </svg>
                </div>
                <div class="is-flex-grow-1 is-flex-shrink-1">
                    <div class="px-6 mt-4 mb-6 content is-flex" id="main-content">
                        <div class="is-flex-grow-1 is-flex-shrink-1">
                            <div class="p-2 has-text-right mb-6">
                                <span>Version</span>
                                <div class="select is-small is-rounded">
                                    <select x-model="version" style="width: 100%" @change="window.location=`/k8s-storage/${version}`">
                                        <option>latest</option>
                                        
                                        <option>1.1.x</option>
                                        
                                        <option>1.0.x</option>
                                        
                                        <option>devel</option>
                                        
                                    </select>
                                </div>
                            </div>
                            <div class="doc-content">
                                <h1>Use external gluster volume as PV in kadalu</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>You can still use kadalu even when you have your storage nodes outside
of the kubernetes (k8s) cluster. We describe this <code>kind</code> of setup as
'External'. Such a description is intended to indicate that the storage
server processes are not managed by kadalu operator.</p>
</div>
<div class="paragraph">
<p>In both the ways please note <code>metadata.name</code> (let&#8217;s say <code>e-vol</code>) in
<code>kind: KadaluStorage</code> will create a StorageClass with name
<code>kadalu.&lt;volname&gt;</code> (<code>volname</code> will be replaced with <code>e-vol</code>).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cleanup_for_re_using_external_gluster_volume">Cleanup for re-using external gluster volume</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you delete a previously used volume (pool) in external gluster from Kadalu, some
folders and files will be left behind as we do not run any commands on external
gluster except quota commands.</p>
</div>
<div class="paragraph">
<p>Please delete below files/dirs from root of gluster bricks after deleting the pool in Kadalu
if exists</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">info/ stat.db virtblock/ subvol/</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_external_gluster_in_kadalu_native_way">Using external gluster in kadalu native way</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this mode, we expect gluster volume to be created and is in 'Started' state.
kadalu storage config takes one of the node IP/hostname, and gluster volume name
to use it as the storage for PVs. The PVs would be provided as subdirectories -
this is similar to how a PV is created in kadalu native way.</p>
</div>
<div class="paragraph">
<p>In order for resources.requests.storage requests to be honored please read <a href="https://github.com/kadalu/kadalu/tree/kadalu_1.1.x/server/README.md">the server documentation</a>.</p>
</div>
<div class="paragraph">
<p>The best example for this is, what we use in our CI. Checkout this
sample yaml file</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># file: external-config.yaml</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kadalu-operator.storage/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">KadaluStorage</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ext-config</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">External</span>
  <span class="c1"># Omitting 'single_pv_per_pool' or using 'false' as a value will create</span>
  <span class="c1"># 1 PV : 1 Subdir in external gluster volume</span>
  <span class="na">single_pv_per_pool</span><span class="pi">:</span> <span class="no">false</span>
  <span class="na">details</span><span class="pi">:</span>
    <span class="c1"># gluster_hosts: [ gluster1.kadalu.io, gluster2.kadalu.io ]</span>
    <span class="na">gluster_host</span><span class="pi">:</span> <span class="s">gluster1.kadalu.io</span>
    <span class="na">gluster_volname</span><span class="pi">:</span> <span class="s">kadalu</span>
    <span class="na">gluster_options</span><span class="pi">:</span> <span class="s">log-level=DEBUG</span>

<span class="c1"># file: pvc-from-external-gluster.yaml</span>
<span class="nn">---</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PersistentVolumeClaim</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">pv-ext-kadalu</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="c1"># Add 'kadalu.' to name from KadaluStorage kind</span>
  <span class="na">storageClassName</span><span class="pi">:</span> <span class="s">kadalu.ext-config</span>
  <span class="na">accessModes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">ReadWriteMany</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">requests</span><span class="pi">:</span>
      <span class="c1"># This needs to be set using 'kadalu-quotad'</span>
      <span class="na">storage</span><span class="pi">:</span> <span class="s">500Mi</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Please edit 'gluster_host' and 'gluster_volname' parameters in config section.</p>
</div>
<div class="paragraph">
<p>You can also setup the external storage through our <code>kubectl kadalu</code> CLI.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>kubectl kadalu storage-add store-name <span class="nt">--external</span> gluster.kadalu.io:/kadalu</code></pre>
</div>
</div>
<div class="paragraph">
<p>After this, just use <code>kadalu.store-name</code> (note that 'store-name' is
name used for <code>storage-add</code>) in PVC yaml, like below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>...
spec:
  storageClassName: kadalu.store-name
  ...</pre>
</div>
</div>
<div class="paragraph">
<p>Note that, if you have an existing gluster setup inside the k8s cluster, you can
treat that also as 'External' and use kadalu to manage it. In this case, you
will need to provide the pre-created gluster volume name for the config.</p>
</div>
<div class="sect2">
<h3 id="_using_glusterfs_directory_quota_to_set_capacity_limitation_for_external_gluster_volumes">Using GlusterFS directory quota to set capacity limitation for external gluster volumes</h3>
<div class="paragraph">
<p>kadalu native way does not support distributed volumes on the external gluster. You could execute the following commands before installation to enable kadalu to achieve PV capacity limitation using the Gluster directory Quota.</p>
</div>
<div class="paragraph">
<p>Please make sure you have enabled quota for external gluster volume before deploying kadalu</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gluster volume quota &lt;volname&gt; enable</pre>
</div>
</div>
<div class="paragraph">
<p>Create namespace in advance for using Secret</p>
</div>
<div class="listingblock">
<div class="content">
<pre>kubectl create namespace kadalu</pre>
</div>
</div>
<div class="paragraph">
<p>Specify the username and secret key of the external Gluster node in Secret for Quota setting.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>kubectl create secret generic glusterquota-ssh-secret --from-literal=glusterquota-ssh-username=&lt;username&gt; --from-file=ssh-privatekey=&lt;ssh_privatekey_path&gt; -n kadalu</pre>
</div>
</div>
<div class="paragraph">
<p>Then install as usual</p>
</div>
<div class="listingblock">
<div class="content">
<pre> kubectl kadalu install</pre>
</div>
</div>
<div class="paragraph">
<p>kadalu sets GlusterFS directory quota to the subdirectories assigned to PVs on the external gluster. kadalu connects to the server via ssh by using the secret key and username of the external gluster in K8s Secret.</p>
</div>
<div class="paragraph">
<p>If you use this configuration, you do not need to install kadalu-quotad to the external gluster server.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_external_storage_directly">Using external storage directly</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this mode, 1 Gluster Volume would be 1 PV. Something very similar to how heketi
project allocates PVs. We don&#8217;t encourage using this mode, nor recommend it in a
new setup. This mode is provided just as an option for those who are consuming
gluster volumes in this mode. This helps to use the PVs used in other deployments
to be still consumed.</p>
</div>
<div class="paragraph">
<p>You&#8217;ll be needing something similar to below config to use whole gluster
volume as a single PV</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># file: external-gluster-as-pv.yaml</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kadalu-operator.storage/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">KadaluStorage</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">pv-ext</span> <span class="c1"># Keep changing the name for different volumes</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">External</span>
  <span class="c1"># Setting 'single_pv_per_pool' as 'true' is important</span>
  <span class="na">single_pv_per_pool</span><span class="pi">:</span> <span class="no">true</span>            <span class="c1"># Will map 1 Gluster Volume : 1 PV</span>
  <span class="na">details</span><span class="pi">:</span>
    <span class="na">gluster_host</span><span class="pi">:</span> <span class="s">gluster1.kadalu.io</span>   <span class="c1"># Change to your gluster host</span>
    <span class="na">gluster_volname</span><span class="pi">:</span> <span class="s">test</span>              <span class="c1"># Change to existing gluster volume</span>
    <span class="na">gluster_options</span><span class="pi">:</span> <span class="s">log-level=DEBUG</span>   <span class="c1"># Comma separated options</span>

<span class="nn">---</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PersistentVolumeClaim</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">pv-ext</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">storageClassName</span><span class="pi">:</span> <span class="s">kadalu.pv-ext</span>
  <span class="na">accessModes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">ReadWriteMany</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">requests</span><span class="pi">:</span>
      <span class="na">storage</span><span class="pi">:</span> <span class="s">200Mi</span> <span class="c1"># This gets ignored in this case.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Please edit <code>gluster_host</code> and <code>gluster_volname</code> parameters in Storage Class.</p>
</div>
<div class="paragraph">
<p>Then run <code>kubectl apply -f ./external-gluster-as-pv.yaml</code></p>
</div>
<div class="paragraph">
<p>Note that in this mode, there would be as many 'StorageClass' as number of PVs, but
that is not avoidable at present because we can&#8217;t pass user driven input from PV claim
yaml.</p>
</div>
</div>
</div>
                            </div>
                        </div>
                        <div class="p-4 is-flex-grow-1 is-flex-shrink-1 is-hidden-touch" x-data="{headings: document.getElementById('main-content').getElementsByTagName('h2')}" style="position:relative">
                            <div style="position: sticky;top:20px">
                                <h4 x-show="headings.length > 0" class="is-size-6 has-text-grey">ON THIS PAGE</h4>
                                <template x-for="heading in headings">
                                    <a class="is-block mb-2" :href="`#${heading.id}`" x-text="heading.textContent"></a>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="footer has-background-primary has-text-white pt-6">
    <div class="columns">
        <div class="column">
            <h2 class="has-font-weight-semibold is-size-5 is-underlined py-2">Community</h2>
            <a class="is-block has-text-white" target="_blank" href="https://join.slack.com/t/kadalu/shared_invite/enQtNzg1ODQ0MDA5NTM2LWMzMTc5ZTJmMjk4MzI0YWVhOGFlZTJjZjY5MDNkZWI0Y2VjMDBlNzVkZmI1NWViN2U3MDNlNDJhNjE5OTBlOGU">Community Slack</a>
            <a class="is-block has-text-white" target="_blank" href="https://github.com/kadalu">Github</a>
            <a class="is-block has-text-white" target="_blank" href="https://kadalu.tech">kadalu.tech</a>
        </div>
    </div>
    <div class="has-text-centered mt-6">
        Copyright &copy; 2022 Kadalu Technologies Private Limited.
    </div>
</div>

        </div>
    </body>
</html>
