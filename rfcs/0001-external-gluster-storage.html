<!DOCTYPE HTML>
<html lang="en">
    <head>
        
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title> | Kadalu </title>
<link href="/static/css/fav.png" rel="icon" type="image/x-icon" />
<link rel="apple-touch-icon" href="/static/css/fav.png" />
<meta name="generator" content="Nanoc 4.12.1">
<meta property="og:title" content=""/>
<meta name="author" content=""/>
<meta property="og:locale" content="en_US"/>
<meta name="description" content=""/>
<meta property="og:description" content=""/>
<link rel="canonical" href="/rfcs/0001-external-gluster-storage.html"/>
<meta property="og:url" content="/rfcs/0001-external-gluster-storage.html"/>
<meta property="og:site_name" content="Kadalu"/>
<meta property="og:image" content=""/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content=""/>
<meta name="twitter:card" content="summary_large_image"/>
<meta property="twitter:image" content=""/>
<meta property="twitter:title" content=""/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <link rel="stylesheet" href="/static/css/stylesheet.css">
<link rel="stylesheet" href="/static/css/syntax-highlight-emacs.css">
<script defer data-domain="kadalu.io" src="https://plausible.io/js/plausible.js"></script>
<script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.8.2/dist/alpine.min.js" defer></script>

    </head>
    <body>
        

<div class="bg-indigo-900">
    <div class="w-full px-5  m-auto py-5">
        <div class="lg:grid lg:grid-cols-12" x-data="{ menuOpen : false }">
            <div class="col-span-4 lg:col-span-2" style="height:40px">
                <a href="/"><img src="/static/css/logo.png" class="h-10 float-left" /></a>
                <button @click="menuOpen = !menuOpen" class="block absolute md:hidden right-7 top-5 w-8 h-8 text-gray-200 p-1">
                    <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
                </button>
            </div>
            <div class="pt-2 col-span-8 lg:col-span-10">
                <nav class="absolute md:relative top-16 left-0 md:top-0 z-20 md:flex flex-col-reverse md:flex-row-reverse md:space-x-3 font-semibold w-full md:w-auto bg-indigo-900 shadow-md rounded-lg md:rounded-none md:shadow-none md:bg-transparent p-6 pt-5 md:p-0"
                     :class="{ 'flex' : menuOpen , 'hidden' : !menuOpen}"  @click.away="menuOpen = false"
                >
                    <a href="/blog" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Blog</a>
                    <a href="/company" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Company</a>
                    <a href="/opensource" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Open Source</a>
                    <a href="/services" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Services</a>
                    <a href="/products" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Products</a>
                    <a href="/docs" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Docs</a>
                </nav>
            </div>
        </div>
    </div>
</div>

        
        <div class="flex flex-col md:grid md:grid-cols-12 w-full" x-data="{docMenuOpen: false}">
            <div class="col-span-3 bg-gray-100" :class="{ 'block mr-10' : docMenuOpen , 'hidden md:block' : !docMenuOpen}" @click.away="docMenuOpen = false">
                <div class="py-5 px-5">
                    
                    
                    <ul>
                        
                        <li class="py-2 md:py-0"><a href="/rfcs">Introduction</a></li>
                        
                        
                        
                        
                        <li class="text-indigo-600 font-semibold py-2 md:py-0">0001 External Gluster Storage</li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/rfcs/0002-test-framework-binnacle.html">0002 Test Framework Binnacle</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/rfcs/0003-kadalu-thin-arbiter-support.html">0003 Kadalu Thin Arbiter Support</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/rfcs/0004-gluster-error-codes.html">0004 Gluster Error Codes</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/rfcs/0005-external-control-plane-gluster.html">0005 External Control Plane Gluster</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/rfcs/0006-optimized-quota-feature-with-namespace.html">0006 Optimized Quota Feature With Namespace</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/rfcs/0007-Using-GlusterFS-directory-quota-for-external-gluster-volumes.html">0007 Using Glusterfs Directory Quota For External Gluster Volumes</a></li>
                        
                        
                        
                    </ul>
                    
                </div>
            </div>
            <div id="main" class="col-span-9">
                <div class="py-5 px-10">
                    
                    <button @click="docMenuOpen = !docMenuOpen" class="block md:hidden w-8 h-8 text-gray-600 mb-5">
                        <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
                    </button>
                    <div class="mb-24 prose max-w-none prose-indigo">
                        <h1>Supporting External Gluster Cluster with Kadalu</h1>
<div class="sect1">
<h2 id="_authors">Authors</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Aravinda Vishwanathapura - <a href="mailto:aravinda@kadalu.io">aravinda@kadalu.io</a></p>
</li>
<li>
<p>Amar Tumballi - <a href="mailto:amar@kadalu.io">amar@kadalu.io</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_summary">Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Kadalu Operator accepts the raw devices provided from each node and creates Gluster volume using those devices. These Gluster Volumes will be used to provision persistent volumes claimed by Kubernetes applications. The Kadalu Operator itself manages Gluster volumes. In this use-case, the user already has managed Gluster cluster, and Kadalu Operator and CSI drivers use the external Gluster Cluster and provision persistent volumes for Kubernetes applications.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_motivation">Motivation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This feature is critical for success of kadalu, as there are many users and administrators who would like to keep storage out of their application management. This way, they can isolate the responsibility and management. We have been asked about such feature in early stages of the project, and many users said that without this feature, they wouldn&#8217;t use the project.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_detailed_design">Detailed design</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The need is further discussed in: <a href="https://github.com/kadalu/kadalu/issues/36" class="bare">https://github.com/kadalu/kadalu/issues/36</a></p>
</div>
<div class="sect2">
<h3 id="_connect_to_remote_glusterd_from_csi_pods">Connect to remote Glusterd from CSI pods</h3>
<div class="paragraph">
<p>Accept the storage configuration with just Volume name and list of primary node and backup nodes, as mentioned in the Github issue.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># File: storage-config.yaml</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kadalu-operator.storage/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">KadaluStorage</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="c1"># This will be used as name of PV Hosting Volume</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ext-storage</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">External</span> <span class="c1">#Here, volume type can be anything</span>
  <span class="na">details</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">gluster_node</span><span class="pi">:</span> <span class="s">node1</span>
      <span class="na">gluster_volname</span><span class="pi">:</span> <span class="s">volume_name</span> <span class="c1"># Volume name</span>
      <span class="na">Gluster_options</span><span class="pi">:</span> <span class="s">log_level=DEBUG</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Deploy this storage configuration using,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>kubectl create <span class="nt">-f</span> storage-config.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of generating Volfile based on Volume info stored in configMap, Gluster clients running in CSI pods directly connect to remote Glusterd and gets Client Volfile.</p>
</div>
<div class="paragraph">
<p>Now, while requesting PV from this storage, use ‘StorageClass’ as <code>kadalu.external.{{ config_name }}</code>, in this case <strong><code>kadalu.external.ext-storage</code></strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_quota">Quota</h3>
<div class="paragraph">
<p>Kadalu provides persistent storage by creating a sub-directory and by setting subdirectory quota(Kadalu uses backend filesystem Quota). Run Kadalu Quota daemon in each Gluster node, which contains brick(s) of exported volume.</p>
</div>
<div class="paragraph">
<p>Add exported volumes list to <code>/var/lib/glusterd/kadalustorage.info</code> and start/restart the kadalu quota daemon.
(TBD: If we can set some metadata to Volumes then no need of external configuration, the daemon can get the list of exported volumes from Volume info).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">systemctl start kadalu-quotad</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For each exported volume, Quota daemon gets local bricks list and crawls each brick and sets Quota when necessary.</p>
</div>
</div>
<div class="sect2">
<h3 id="_challenges">Challenges</h3>
<div class="ulist">
<ul>
<li>
<p>We may not have execution permission on Gluster Cluster, and hence, all ‘side-car’ container tasks we are planning to do would need to be run by the admin on gluster cluster.</p>
<div class="ulist">
<ul>
<li>
<p>Quota</p>
</li>
<li>
<p>Monitoring</p>
</li>
<li>
<p>Backup</p>
</li>
</ul>
</div>
</li>
<li>
<p>The volume may have features we don’t support</p>
</li>
<li>
<p>The volume may have distribute, in which case, some assumptions we have made would go wrong.</p>
</li>
<li>
<p>The bricks may not be using xfs.</p>
</li>
<li>
<p>Gluster version in CSI pods may be different from than version of the external Gluster cluster. A possible solution is to release CSI container images with different Gluster versions.</p>
</li>
<li>
<p>If Volume options or sub-volume changes in the externally managed cluster, will Glusterfs client running in CSI pods gets the notification?</p>
</li>
<li>
<p>CSI pods should have access to nodes of Gluster cluster, That means CSI pods can connect to any Gluster nodes(Port 24007 and brick ports)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_assumptions">Assumptions</h3>
<div class="paragraph">
<p>With the above Challenges, to deliver a feature, it is good for us to go with some assumptions, and guidelines.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only xfs bricks are supported now, Quota works only if the externally managed Gluster Volume contains bricks with xfs filesystem and projectquota is enabled on these brick mounts.</p>
</li>
<li>
<p>Only glusterfs version 6 or higher to be used on gluster-cluster (ie, RHGS 3.5 and above if one is using RHGS).</p>
</li>
<li>
<p>Only Single brick volume, or Replicate/Disperse/Arbiter volume supported. Ie, if distribute is used, the volume size limit for PV users wouldn’t be valid, hence not supported.</p>
</li>
<li>
<p>Python3 support is expected on the Brick host machine.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_improvements">Improvements</h3>
<div class="paragraph">
<p>Considering even heketi created volumes can become an external entity for same ‘External’ type, proposing 1 more fields in the config 'KadaluStorage'.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">kadalu-format </span><span class="pi">:</span> <span class="no">true</span><span class="s">/false</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This option will tell CSI driver, how the data / PV layout is. If it is a subdirectory based (ie, kadalu model), or heketi model, which means, the whole volume is a single PV.</p>
</div>
</div>
<div class="sect2">
<h3 id="_implementation">Implementation</h3>
<div class="paragraph">
<p>The initial work towards this has been done in below PRs.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/kadalu/kadalu/pull/88" class="bare">https://github.com/kadalu/kadalu/pull/88</a></p>
</li>
<li>
<p><a href="https://github.com/kadalu/kadalu/pull/81" class="bare">https://github.com/kadalu/kadalu/pull/81</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="bg-gray-800 text-gray-100 py-10">
    <div class="mx-auto w-full px-5 " style="min-height: 40vh">
        <div class="md:grid gap-2 md:grid-cols-4 md:gap-4">
            <div class="mb-10">
                <h2 class="text-xl font-semibold text-indigo-300">Kadalu</h2>
                <ul>
                    <li><a href="/products#k8s-native-storage">Kubernetes native Storage</a></li>
                    <li><a href="/products#kadalu-storage">Kadalu Storage</a></li>
                    <li><a href="/products#glusterup">GlusterFS monitoring</a></li>
                    <li><a href="/services">Services</a></li>
                    <li><a href="/services#features">Feature development</a></li>
                    <li><a href="/services#upgrade">Upgrade assistance</a></li>
                    <li><a href="/services#consultancy">Consultancy</a></li>
                    <li><a href="/security">Security</a></li>
                </ul>
            </div>

            <div class="mb-10">
                <h2 class="text-xl font-semibold text-indigo-300">Community</h2>
                <ul>
                    <li><a href="/opensource">Open Source</a></li>
                    <li><a href="https://join.slack.com/t/kadalu/shared_invite/enQtNzg1ODQ0MDA5NTM2LWMzMTc5ZTJmMjk4MzI0YWVhOGFlZTJjZjY5MDNkZWI0Y2VjMDBlNzVkZmI1NWViN2U3MDNlNDJhNjE5OTBlOGU">Slack</a></li>
                    <li><a href="https://github.com/kadalu">Github</a></li>
                    <!-- <li><a href="/office-hours">Office Hours</a></li> -->
                </ul>
            </div>

            <div class="mb-10">
                <h2 class="text-xl font-semibold text-indigo-300">Learn</h2>
                <ul>
                    <li><a href="/docs">Documentation</a></li>
                    <li><a href="/blog">Blog</a></li>
                    <li><a href="/faq">FAQ</a></li>
                    <li><a href="/rfcs">RFCs</a></li>
                    <!-- <li><a href="/compare">Compare</a></li> -->
                </ul>
            </div>

            <div class="mb-10">
                <h2 class="text-xl font-semibold text-indigo-300">Company</h2>
                <ul>
                    <li><a href="/company">About</a></li>
                    <li><a href="/contact">Contact</a></li>
                    <li><a href="/sitemap.xml">Sitemap</a></li>
                </ul>

                <h2 class="text-xl font-semibold text-indigo-300 mt-10">Write to us</h2>
                <ul>
                    <li><a href="mailto:hello@kadalu.io"><svg class="w-4 h-4 inline-block mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path></svg>hello@kadalu.io</a></li>
                </ul>

                <h2 class="text-xl font-semibold text-indigo-300 mt-10">Follow Us</h2>
                <ul>
                    <li><a href="https://twitter.com/kadaluio">Twitter</a></li>
                    <li><a href="https://linkedin.com/company/kadalu-io">Linkedin</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>
<div class="bg-gray-800 text-gray-100 py-10">
    <div class="mx-auto w-3/4 text-center text-gray-300 mb-10">
        &copy; 2022 Kadalu Software Private Limited. All Rights Reserved.
    </div>
</div>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-144588868-2"></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-144588868-2');
</script>


    </body>
</html>
