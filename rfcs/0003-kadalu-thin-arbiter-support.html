<!DOCTYPE HTML>
<html lang="en">
    <head>
        
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title> | Kadalu </title>
<link href="/static/css/fav.png" rel="icon" type="image/x-icon" />
<link rel="apple-touch-icon" href="/static/css/fav.png" />
<meta name="generator" content="Nanoc 4.12.1">
<meta property="og:title" content=""/>
<meta name="author" content=""/>
<meta property="og:locale" content="en_US"/>
<meta name="description" content=""/>
<meta property="og:description" content=""/>
<link rel="canonical" href="/rfcs/0003-kadalu-thin-arbiter-support.html"/>
<meta property="og:url" content="/rfcs/0003-kadalu-thin-arbiter-support.html"/>
<meta property="og:site_name" content="Kadalu"/>
<meta property="og:image" content=""/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content=""/>
<meta name="twitter:card" content="summary_large_image"/>
<meta property="twitter:image" content=""/>
<meta property="twitter:title" content=""/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <link rel="stylesheet" href="/static/css/stylesheet.css">
<link rel="stylesheet" href="/static/css/syntax-highlight-emacs.css">
<script defer data-domain="kadalu.io" src="https://plausible.io/js/plausible.js"></script>
<script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.8.2/dist/alpine.min.js" defer></script>

    </head>
    <body>
        

<div class="bg-indigo-900">
    <div class="w-full px-5  m-auto py-5">
        <div class="lg:grid lg:grid-cols-12" x-data="{ menuOpen : false }">
            <div class="col-span-4 lg:col-span-2" style="height:40px">
                <a href="/"><img src="/static/css/logo.png" class="h-10 float-left" /></a>
                <button @click="menuOpen = !menuOpen" class="block absolute md:hidden right-7 top-5 w-8 h-8 text-gray-200 p-1">
                    <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
                </button>
            </div>
            <div class="pt-2 col-span-8 lg:col-span-10">
                <nav class="absolute md:relative top-16 left-0 md:top-0 z-20 md:flex flex-col-reverse md:flex-row-reverse md:space-x-3 font-semibold w-full md:w-auto bg-indigo-900 shadow-md rounded-lg md:rounded-none md:shadow-none md:bg-transparent p-6 pt-5 md:p-0"
                     :class="{ 'flex' : menuOpen , 'hidden' : !menuOpen}"  @click.away="menuOpen = false"
                >
                    <a href="/blog" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Blog</a>
                    <a href="/opensource" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Open Source</a>
                    <a href="/docs" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Docs</a>
                </nav>
            </div>
        </div>
    </div>
</div>

        
        <div class="flex flex-col md:grid md:grid-cols-12 w-full" x-data="{docMenuOpen: false}">
            <div class="col-span-3 bg-gray-100" :class="{ 'block mr-10' : docMenuOpen , 'hidden md:block' : !docMenuOpen}" @click.away="docMenuOpen = false">
                <div class="py-5 px-5">
                    
                    
                    <ul>
                        
                        <li class="py-2 md:py-0"><a href="/rfcs">Introduction</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/rfcs/0001-external-gluster-storage.html">0001 External Gluster Storage</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/rfcs/0002-test-framework-binnacle.html">0002 Test Framework Binnacle</a></li>
                        
                        
                        
                        
                        <li class="text-indigo-600 font-semibold py-2 md:py-0">0003 Kadalu Thin Arbiter Support</li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/rfcs/0004-gluster-error-codes.html">0004 Gluster Error Codes</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/rfcs/0005-external-control-plane-gluster.html">0005 External Control Plane Gluster</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/rfcs/0006-optimized-quota-feature-with-namespace.html">0006 Optimized Quota Feature With Namespace</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/rfcs/0007-Using-GlusterFS-directory-quota-for-external-gluster-volumes.html">0007 Using Glusterfs Directory Quota For External Gluster Volumes</a></li>
                        
                        
                        
                    </ul>
                    
                </div>
            </div>
            <div id="main" class="col-span-9">
                <div class="py-5 px-10">
                    
                    <button @click="docMenuOpen = !docMenuOpen" class="block md:hidden w-8 h-8 text-gray-600 mb-5">
                        <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
                    </button>
                    <div class="mb-24 prose max-w-none prose-indigo">
                        <h1>Thin Arbiter support for Kadalu Storage</h1>
<div class="sect1">
<h2 id="_authors">Author(s)</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Amar Tumballi <a href="mailto:amar@kadalu.io">amar@kadalu.io</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_reference">Reference</h3>
<div class="paragraph">
<p><a href="https://github.com/kadalu/kadalu/issues/37" class="bare">https://github.com/kadalu/kadalu/issues/37</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Thin-Arbiter is a feature of glusterfs, introduced in v7.0 (Nov 2019). This feature provides a better 'high-availability' solution than replica 2 setup. Replica 2 setups are now not recommended in glusterfs, but default supported is Replica 3 or Replica 2 with Arbiter node.</p>
</div>
<div class="paragraph">
<p>The challenge with Replica3 is, the cost of adding one more full set of data is high for users (1/3 increase in hardware cost, and 1/3 reduction in write speed). Hence the recommended solution was 'Arbiter' volume type in gluster, which reduced the 'storage cost' involved in 3rd copy, as it doesn&#8217;t host any data, but still user has to manage 3 set of machines, and even in arbiter case, the latency requirements are high.</p>
</div>
<div class="paragraph">
<p>So, the thin-arbiter feature is very useful for users who have just 2 data centers with required latency, but not the 3rd. With this feature, all such users can actually have the 3rd tie-breaker node in cloud without latency limitation.</p>
</div>
<div class="paragraph">
<p>Even for kadalu users, if you have a stretched k8s cluster, which spans across 2 data centers (or 2 availability zones in Cloud), this feature will be useful. This helps by reducing the resources required for high-availability, and also the speed of write (1/2 instead of 1/3).</p>
</div>
<div class="paragraph">
<p>The design details of thin-arbiter was discussed <a href="https://github.com/gluster/glusterfs/issues/352">here</a> and <a href="https://docs.gluster.org/en/latest/Administrator%20Guide/Thin-Arbiter-Volumes/">here</a>. In this proposal we will talk about how we can add thin-arbiter volume type to kadalu.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_design">Design</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Kadalu works with predefined volume templates for gluster. We need add thin-arbiter template, and also define a specific storage <code>Type</code> for this template. The same can be used for storage-config 'type' too. Already <code>Replica1</code> and <code>Replica3</code> namespace taken. We can choose 'Replica2' as it is indeed a replica2 setup.</p>
</div>
<div class="paragraph">
<p>Motive behind picking Replica2 for thin-arbiter is also because kadalu project would hide the complexity of gluster, and for kadalu users, there is no need to know about gluster&#8217;s storage options.</p>
</div>
<div class="paragraph">
<p>Proposed config file looks something like below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># File: storage-config.yaml</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kadalu-operator.storage/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">KadaluStorage</span>
<span class="na">metadata</span><span class="pi">:</span>
 <span class="c1"># This will be used as name of PV Hosting Volume</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">storage-pool-name</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">Replica2</span>       <span class="c1"># Just to highlight your data is just in 2 places.</span>
  <span class="na">storage</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">node</span><span class="pi">:</span> <span class="s">kube1</span>      <span class="c1"># node name as shown in `kubectl get nodes`</span>
      <span class="na">device</span><span class="pi">:</span> <span class="s">/dev/vdc</span> <span class="c1"># Device to provide storage to all PVs</span>
    <span class="pi">-</span> <span class="na">node</span><span class="pi">:</span> <span class="s">kube2</span>      <span class="c1"># node name as shown in `kubectl get nodes`</span>
      <span class="na">device</span><span class="pi">:</span> <span class="s">/dev/vdc</span> <span class="c1"># Device to provide storage to all PVs</span>
  <span class="na">tie-breaker</span><span class="pi">:</span> <span class="c1"># Optional. If not present, would consider</span>
               <span class="c1"># 'tie-breaker.kadalu.io:/mnt' as the option.</span>
    <span class="na">node</span><span class="pi">:</span> <span class="s">tie-breaker.kadalu.io</span>
    <span class="na">path</span><span class="pi">:</span> <span class="s">/mnt/tie-breaker/</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the PV spec, one would need to use the option as below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># -*- mode: yaml -*-</span>
<span class="nn">---</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PersistentVolumeClaim</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">pv1</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">storageClassName</span><span class="pi">:</span> <span class="s">kadalu.replica2</span>
  <span class="na">accessModes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">ReadWriteOnce</span> <span class="c1"># You can also provide 'ReadWriteMany' here</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">requests</span><span class="pi">:</span>
      <span class="na">storage</span><span class="pi">:</span> <span class="s">1Gi</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The main definition which needs to be properly validated would be of <code>tie-breaker</code>. There is no need to provide this option, in which case it takes <strong>'tie-breaker.kadalu.io:/mnt'</strong> as the option. Kadalu would 'host' a tie-breaker node, and allow anyone to have tie-breaker node on the web.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_further_improvement">Further improvement</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the similar lines, we can add support for 'Arbiter' too, as there may be users who would like to have arbiter support in kadalu. Need to have a reserved type for the same (may be 'Arbiter'). But, it doesn&#8217;t make sense to expose that option much if thin-arbiter works fine for us.</p>
</div>
</div>
</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="bg-gray-800 text-gray-100 py-10">
    <div class="mx-auto w-full px-5 " style="min-height: 40vh">
        <div class="md:grid gap-2 md:grid-cols-4 md:gap-4">
            <div class="mb-10">
                <h2 class="text-xl font-semibold text-indigo-300">Community</h2>
                <ul>
                    <li><a href="/opensource">Open Source</a></li>
                    <li><a href="https://join.slack.com/t/kadalu/shared_invite/enQtNzg1ODQ0MDA5NTM2LWMzMTc5ZTJmMjk4MzI0YWVhOGFlZTJjZjY5MDNkZWI0Y2VjMDBlNzVkZmI1NWViN2U3MDNlNDJhNjE5OTBlOGU">Slack</a></li>
                    <li><a href="https://github.com/kadalu">Github</a></li>
                </ul>
            </div>

            <div class="mb-10">
                <h2 class="text-xl font-semibold text-indigo-300">Learn</h2>
                <ul>
                    <li><a href="/docs">Documentation</a></li>
                    <li><a href="/blog">Blog</a></li>
                    <li><a href="/faq">FAQ</a></li>
                    <li><a href="/rfcs">RFCs</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>
<div class="bg-gray-800 text-gray-100 py-10">
    <div class="mx-auto w-3/4 text-center text-gray-300 mb-10">
        &copy; 2022 Kadalu Community(https://github.com/kadalu). All Rights Reserved.
    </div>
</div>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-144588868-2"></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-144588868-2');
</script>


    </body>
</html>
