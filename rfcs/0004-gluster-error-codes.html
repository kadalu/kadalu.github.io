<!DOCTYPE HTML>
<html lang="en">
    <head>
        
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title> | Kadalu </title>
<link href="/static/css/fav.png" rel="icon" type="image/x-icon" />
<link rel="apple-touch-icon" href="/static/css/fav.png" />
<meta name="generator" content="Nanoc 4.12.1">
<meta property="og:title" content=""/>
<meta name="author" content=""/>
<meta property="og:locale" content="en_US"/>
<meta name="description" content=""/>
<meta property="og:description" content=""/>
<link rel="canonical" href="/rfcs/0004-gluster-error-codes.html"/>
<meta property="og:url" content="/rfcs/0004-gluster-error-codes.html"/>
<meta property="og:site_name" content="Kadalu"/>
<meta property="og:image" content=""/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content=""/>
<meta name="twitter:card" content="summary_large_image"/>
<meta property="twitter:image" content=""/>
<meta property="twitter:title" content=""/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <link rel="stylesheet" href="/static/css/stylesheet.css">
<link rel="stylesheet" href="/static/css/syntax-highlight-emacs.css">
<script defer src="https://unpkg.com/alpinejs@3.2.2/dist/cdn.min.js"></script>

    </head>
    <body>
        

<div class="bg-indigo-900">
    <div class="w-full px-5  m-auto py-5">
        <div class="lg:grid lg:grid-cols-12" x-data="{ menuOpen : false }">
            <div class="col-span-4 lg:col-span-2" style="height:40px">
                <a href="/"><img src="/static/css/logo.png" class="h-10 float-left" /></a>
                <button @click="menuOpen = !menuOpen" class="block absolute md:hidden right-7 top-5 w-8 h-8 text-gray-200 p-1">
                    <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
                </button>
            </div>
            <div class="pt-2 col-span-8 lg:col-span-10">
                <nav class="absolute md:relative top-16 left-0 md:top-0 z-20 md:flex flex-col-reverse md:flex-row-reverse md:space-x-3 font-semibold w-full md:w-auto bg-indigo-900 shadow-md rounded-lg md:rounded-none md:shadow-none md:bg-transparent p-6 pt-5 md:p-0"
                     :class="{ 'flex' : menuOpen , 'hidden' : !menuOpen}" @keyup.escape.window="menuOpen = false"
                >
                    <a href="/blog" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Blog</a>
                    <a href="/company" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Company</a>
                    <a href="/opensource" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Open Source</a>
                    <a href="/services" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Services</a>
                    <a href="/products" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Products</a>
                    <a href="/docs" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Docs</a>
                </nav>
            </div>
        </div>
    </div>
</div>

        
        <div class="flex flex-col md:grid md:grid-cols-12 w-full" x-data="{docMenuOpen: false}">
            <div class="col-span-3 bg-gray-100" :class="{ 'block mr-10' : docMenuOpen , 'hidden md:block' : !docMenuOpen}" @click.away="docMenuOpen = false">
                <div class="py-5 px-5">
                    
                    
                    <ul>
                        
                        <li class="py-2 md:py-0"><a href="/rfcs">Introduction</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/rfcs/0001-external-gluster-storage.html">0001 External Gluster Storage</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/rfcs/0002-test-framework-binnacle.html">0002 Test Framework Binnacle</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/rfcs/0003-kadalu-thin-arbiter-support.html">0003 Kadalu Thin Arbiter Support</a></li>
                        
                        
                        
                        
                        <li class="text-indigo-600 font-semibold py-2 md:py-0">0004 Gluster Error Codes</li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/rfcs/0005-external-control-plane-gluster.html">0005 External Control Plane Gluster</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/rfcs/0006-optimized-quota-feature-with-namespace.html">0006 Optimized Quota Feature With Namespace</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/rfcs/0007-Using-GlusterFS-directory-quota-for-external-gluster-volumes.html">0007 Using Glusterfs Directory Quota For External Gluster Volumes</a></li>
                        
                        
                        
                    </ul>
                    
                </div>
            </div>
            <div id="main" class="col-span-9">
                <div class="py-5 px-10">
                    
                    <button @click="docMenuOpen = !docMenuOpen" class="block md:hidden w-8 h-8 text-gray-600 mb-5">
                        <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
                    </button>
                    <div class="mb-24 prose max-w-none prose-indigo">
                        <h1>Error codes in Gluster</h1>
<div class="sect1">
<h2 id="_versions">Versions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>v0.1 -  24th  Jan, 2020.</p>
</div>
<div class="sect2">
<h3 id="_contributors">Contributors</h3>
<div class="ulist">
<ul>
<li>
<p>Amar Tumballi &lt;<a href="mailto:amar@kadalu.io">amar@kadalu.io</a>&gt; <a href="https://github.com/amarts">@amarts</a></p>
</li>
<li>
<p>Xavi Hernandez &lt;<a href="mailto:jahernan@redhat.com">jahernan@redhat.com</a>&gt; <a href="https://github.com/xhernandez">@xhernandez</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_special_thanks">Special thanks</h3>
<div class="ulist">
<ul>
<li>
<p>Jeff Darcy &lt;<a href="mailto:jeff@pl.atyp.us">jeff@pl.atyp.us</a>&gt; - <a href="https://github.com/jdarcy">@jdarcy</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_reference">Reference</h3>
<div class="paragraph">
<p><a href="https://github.com/gluster/glusterfs/issues/280" class="bare">https://github.com/gluster/glusterfs/issues/280</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The above github issue talks about the need for error-codes in glusterfs, and even goes to the details of how we can achieve it. This document is an attempt to consolidate all those points and come at something meaningful before we implement it for real.</p>
</div>
<div class="paragraph">
<p>The need for this is very simple, and critical too. At any point of execution, if there is a failure, we should be having exact reason for failure, instead of making guesses. This also allows us to reduce the logs, and debugging effort in case of problems. If a product is easy to debug, then it means, it is easy to maintain, and improve.</p>
</div>
<div class="sect2">
<h3 id="_challenges">Challenges</h3>
<div class="ulist">
<ul>
<li>
<p>The first and foremost problem is, the amount of changes we need to do to complete the effort.</p>
</li>
<li>
<p>Changes shouldn&#8217;t be very disruptive, and should be easier to review.</p>
</li>
<li>
<p>This should be done without disturbing the current code flow, so we can break it into multiple smaller patches, without breaking regression.</p>
</li>
<li>
<p>Need contribution across codebase, so more of collaborated activity.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_points_from_github_issue">Points from github issue</h3>
<div class="ulist">
<ul>
<li>
<p>We only have 32 bits to use, so breaking it into multiple groups of fewer bits would be useful.</p>
</li>
<li>
<p>Originator ID (to identify which xlator) caused the issue is very helpful.</p>
</li>
<li>
<p>The errorcodes should be negative to indicate error, so, 0 can be reserved for success, and +ve is for other overloaded success values.</p>
</li>
<li>
<p>Instead of static id, good to get originator-id (or xlator id) in run time.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_proposed_solution">Proposed solution</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Use return value to indicate error code, let errno continue to exist till we make complete changes.</p>
<div class="ulist">
<ul>
<li>
<p>This is easier to make change in codebase, as <code>(ret &lt; 0)</code> is considered failure already.</p>
</li>
<li>
<p>This doesn&#8217;t impact the checks we have to compare errno and then decide what to do. Keeping it the same would make regressions run smoothly and also would help in quicker reviews.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Reserve 8k worth (13bits) of error-codes per translator.</p>
<div class="ulist">
<ul>
<li>
<p>Allows 17 more bits for originator-id and other things.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Provide a thread local pointer in <code>gf_strerror()</code>, so one can use it similar to <code>strerror()</code>. Also provide an alternative to return filled pointer like <code>uuid_utoa_r()</code>.</p>
<div class="ulist">
<ul>
<li>
<p>The thread local pointer would be used in most places where it is just used in logging.</p>
</li>
<li>
<p>The alternative method would be used if one needs to store the pointer, or use it more than one time.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Make sure to check the complete execution path to treat negative value as error, not just -1.</p>
<div class="ulist">
<ul>
<li>
<p>This should be done more carefully.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Let each translator have their static ID through enum.</p>
<div class="ulist">
<ul>
<li>
<p>In the initial version it wouldn&#8217;t be runtime, and not per instance of xlator.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_future_improvements">Future improvements</h3>
<div class="paragraph">
<p>Design a way to get details of translators running on server-side, and their run-time-id, during client-handshake. That way, we can pin-point the issue to a particular instance of translator in future, instead of the static id. This will be useful for translators designed and written outside of glusterfs too.</p>
</div>
</div>
</div>
</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="bg-gray-800 text-gray-100 py-10">
    <div class="mx-auto w-full px-5 " style="min-height: 40vh">
        <div class="md:grid gap-2 md:grid-cols-4 md:gap-4">
            <div class="mb-10">
                <h2 class="text-xl font-semibold text-indigo-300">Kadalu</h2>
                <ul>
                    <li><a href="/products#k8s-native-storage">Kubernetes native Storage</a></li>
                    <li><a href="/products#kadalu-storage">Kadalu Storage</a></li>
                    <li><a href="/products#glusterup">GlusterFS monitoring</a></li>
                    <li><a href="/services">Services</a></li>
                    <li><a href="/services#features">Feature development</a></li>
                    <li><a href="/services#upgrade">Upgrade assistance</a></li>
                    <li><a href="/services#consultancy">Consultancy</a></li>
                    <li><a href="/security">Security</a></li>
                </ul>
            </div>

            <div class="mb-10">
                <h2 class="text-xl font-semibold text-indigo-300">Community</h2>
                <ul>
                    <li><a href="/opensource">Open Source</a></li>
                    <li><a href="https://join.slack.com/t/kadalu/shared_invite/enQtNzg1ODQ0MDA5NTM2LWMzMTc5ZTJmMjk4MzI0YWVhOGFlZTJjZjY5MDNkZWI0Y2VjMDBlNzVkZmI1NWViN2U3MDNlNDJhNjE5OTBlOGU">Slack</a></li>
                    <li><a href="https://github.com/kadalu">Github</a></li>
                    <!-- <li><a href="/office-hours">Office Hours</a></li> -->
                </ul>
            </div>

            <div class="mb-10">
                <h2 class="text-xl font-semibold text-indigo-300">Learn</h2>
                <ul>
                    <li><a href="/docs">Documentation</a></li>
                    <li><a href="/blog">Blog</a></li>
                    <li><a href="/faq">FAQ</a></li>
                    <li><a href="/rfcs">RFCs</a></li>
                    <!-- <li><a href="/compare">Compare</a></li> -->
                </ul>
            </div>

            <div class="mb-10">
                <h2 class="text-xl font-semibold text-indigo-300">Company</h2>
                <ul>
                    <li><a href="/company">About</a></li>
                    <li><a href="/contact">Contact</a></li>
                    <li><a href="/sitemap.xml">Sitemap</a></li>
                </ul>

                <h2 class="text-xl font-semibold text-indigo-300 mt-10">Write to us</h2>
                <ul>
                    <li><a href="mailto:hello@kadalu.io"><svg class="w-4 h-4 inline-block mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path></svg>hello@kadalu.io</a></li>
                </ul>

                <h2 class="text-xl font-semibold text-indigo-300 mt-10">Follow Us</h2>
                <ul>
                    <li><a href="https://twitter.com/kadaluio">Twitter</a></li>
                    <li><a href="https://linkedin.com/company/kadalu-io">Linkedin</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>
<div class="bg-gray-800 text-gray-100 py-10">
    <div class="mx-auto w-3/4 text-center text-gray-300 mb-10">
        &copy; 2021 Kadalu Software Private Limited. All Rights Reserved.
    </div>
</div>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-144588868-2"></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-144588868-2');
</script>


    </body>
</html>
