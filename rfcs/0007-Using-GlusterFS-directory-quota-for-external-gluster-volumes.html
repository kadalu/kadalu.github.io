<!DOCTYPE HTML>
<html lang="en">
    <head>
        
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title> | Kadalu </title>
<link href="/static/css/fav.png" rel="icon" type="image/x-icon" />
<link rel="apple-touch-icon" href="/static/css/fav.png" />
<meta name="generator" content="Nanoc 4.12.1">
<meta property="og:title" content=""/>
<meta name="author" content=""/>
<meta property="og:locale" content="en_US"/>
<meta name="description" content=""/>
<meta property="og:description" content=""/>
<link rel="canonical" href="/rfcs/0007-Using-GlusterFS-directory-quota-for-external-gluster-volumes.html"/>
<meta property="og:url" content="/rfcs/0007-Using-GlusterFS-directory-quota-for-external-gluster-volumes.html"/>
<meta property="og:site_name" content="Kadalu"/>
<meta property="og:image" content=""/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content=""/>
<meta name="twitter:card" content="summary_large_image"/>
<meta property="twitter:image" content=""/>
<meta property="twitter:title" content=""/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <link rel="stylesheet" href="/static/css/stylesheet.css">
<link rel="stylesheet" href="/static/css/syntax-highlight-emacs.css">
<script defer data-domain="kadalu.io" src="https://plausible.io/js/plausible.js"></script>
<script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.8.2/dist/alpine.min.js" defer></script>

    </head>
    <body>
        

<div class="bg-indigo-900">
    <div class="w-full px-5  m-auto py-5">
        <div class="lg:grid lg:grid-cols-12" x-data="{ menuOpen : false }">
            <div class="col-span-4 lg:col-span-2" style="height:40px">
                <a href="/"><img src="/static/css/logo.png" class="h-10 float-left" /></a>
                <button @click="menuOpen = !menuOpen" class="block absolute md:hidden right-7 top-5 w-8 h-8 text-gray-200 p-1">
                    <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
                </button>
            </div>
            <div class="pt-2 col-span-8 lg:col-span-10">
                <nav class="absolute md:relative top-16 left-0 md:top-0 z-20 md:flex flex-col-reverse md:flex-row-reverse md:space-x-3 font-semibold w-full md:w-auto bg-indigo-900 shadow-md rounded-lg md:rounded-none md:shadow-none md:bg-transparent p-6 pt-5 md:p-0"
                     :class="{ 'flex' : menuOpen , 'hidden' : !menuOpen}"  @click.away="menuOpen = false"
                >
                    <a href="/blog" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Blog</a>
                    <a href="/company" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Company</a>
                    <a href="/opensource" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Open Source</a>
                    <a href="/services" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Services</a>
                    <a href="/products" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Products</a>
                    <a href="/docs" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Docs</a>
                </nav>
            </div>
        </div>
    </div>
</div>

        
        <div class="flex flex-col md:grid md:grid-cols-12 w-full" x-data="{docMenuOpen: false}">
            <div class="col-span-3 bg-gray-100" :class="{ 'block mr-10' : docMenuOpen , 'hidden md:block' : !docMenuOpen}" @click.away="docMenuOpen = false">
                <div class="py-5 px-5">
                    
                    
                    <ul>
                        
                        <li class="py-2 md:py-0"><a href="/rfcs">Introduction</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/rfcs/0001-external-gluster-storage.html">0001 External Gluster Storage</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/rfcs/0002-test-framework-binnacle.html">0002 Test Framework Binnacle</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/rfcs/0003-kadalu-thin-arbiter-support.html">0003 Kadalu Thin Arbiter Support</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/rfcs/0004-gluster-error-codes.html">0004 Gluster Error Codes</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/rfcs/0005-external-control-plane-gluster.html">0005 External Control Plane Gluster</a></li>
                        
                        
                        
                        
                        <li class="py-2 md:py-0"><a href="/rfcs/0006-optimized-quota-feature-with-namespace.html">0006 Optimized Quota Feature With Namespace</a></li>
                        
                        
                        
                        
                        <li class="text-indigo-600 font-semibold py-2 md:py-0">0007 Using Glusterfs Directory Quota For External Gluster Volumes</li>
                        
                        
                        
                    </ul>
                    
                </div>
            </div>
            <div id="main" class="col-span-9">
                <div class="py-5 px-10">
                    
                    <button @click="docMenuOpen = !docMenuOpen" class="block md:hidden w-8 h-8 text-gray-600 mb-5">
                        <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
                    </button>
                    <div class="mb-24 prose max-w-none prose-indigo">
                        <h1>Using GlusterFS directory quota to set capacity limitation for external gluster volumes</h1>
<div class="sect1">
<h2 id="_summary">Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is necessary to set a capacity limit for PVs. When external gluster volume is used, kaDalu uses kadalu-quotad to set the capacity limit on the newly created volumes. However, the current implementation of kadalu-quotad does not support distributed volumes on the external GlusterFS servers. Our proposal uses GlusterFS directory quota for external gluster volumes so that kaDalu can limit the capacity of the distributed volumes.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_authors">Authors</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Yugo Yamauchi &lt;<a href="mailto:yugo.yamauchi.cf@hitachi.com">yugo.yamauchi.cf@hitachi.com</a>&gt;</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_motivation">Motivation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since kaDalu v0.8.0, KaDalu uses simple-quota to limit the capacity of PVs. However the simple-quota is available only in kadalu-storage (A fork of GlusterFS for kaDalu). When other versions of GlusterFS are used, kaDalu uses kadalu-quotad to limit the capacity of PVs on external gluster volumes. However, kadalu-quotad does not support distributed volumes. In addition, a user need to install the kadalu-quotad package to the external GlusterFS servers and it might not be a possible option in some production systems. GlusterFS&#8217;s directory quota solves these problems. Our approach supports distributed volumes and does not require any additional setup on the external GlusterFS servers.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_detailed_design">Detailed design</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In our approach, the provisioner sets GlusterFS directory quota to the subdirectories assigned to PVs on the external GlusterFS server. The provisioner connects to the server via ssh by using the secret key and username of the external GlusterFS server in K8s Secret. A user creates the K8s Secret during kadalu install to enable this function.</p>
</div>
<div class="sect2">
<h3 id="_implementation">Implementation</h3>
<div class="paragraph">
<p>The provisioner sets GlusterFS directory quota to the PVâ€™s subdirectories in CreateVolume which execute PV provisioning and subdirectory creating. When creating a PV and a subdirectory, the provisioner connects to the external GlusterFS server via ssh and sets the directory Quota. The ssh private key is given by the user as K8s Secret in advance. If a private key file and username are specified in K8s Secret, the provisioner executes the following command in CreateVolume.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># ssh -i &lt;ssh_privatekey&gt; &lt;username&gt;@&lt;Glusterhost&gt; sudo gluster volume quota &lt;gluster_volume_name&gt; limit-usage &lt;quota-path&gt; &lt;quota-size&gt;
# ssh -i &lt;ssh_privatekey&gt; &lt;username&gt;@&lt;Glusterhost&gt; sudo gluster volume set &lt;gluster_volume_name&gt; quota-deem-statfs on</pre>
</div>
</div>
<div class="paragraph">
<p>If K8s Secret is not set, the provisioner works in the same way with as usual kadalu-quotad.</p>
</div>
</div>
<div class="sect2">
<h3 id="_if">I/F</h3>
<div class="paragraph">
<p>Before the kaDalu installation, a user creates K8s Secret with the server private key and the username of the external GlusterFS servers by executing the following commands.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># kubectl create namespace kadalu
# kubectl create secret generic glusterquota-ssh-secret \
    --from-literal=glusterquota-ssh-username=&lt;username&gt; \
    --from-file=ssh-privatekey=&lt;ssh_privatekey_path&gt; -n kadalu</pre>
</div>
</div>
<div class="paragraph">
<p>Then install kaDalu in the usual procedure.</p>
</div>
<div class="paragraph">
<p>When the K8s Secrets is set before the installation, kaDalu uses GlusterFS directory quota for external gluster volumes instead of kadalu-quotad.</p>
</div>
</div>
<div class="sect2">
<h3 id="_error_handling">Error Handling</h3>
<div class="paragraph">
<p>If ssh fails, an error message will be output and volume provisioning will fail.
If the username or the ssh private key file are empty, the provisioner will work in the same way as the usual kadalu-quotad.</p>
</div>
</div>
</div>
</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="bg-gray-800 text-gray-100 py-10">
    <div class="mx-auto w-full px-5 " style="min-height: 40vh">
        <div class="md:grid gap-2 md:grid-cols-4 md:gap-4">
            <div class="mb-10">
                <h2 class="text-xl font-semibold text-indigo-300">Kadalu</h2>
                <ul>
                    <li><a href="/products#k8s-native-storage">Kubernetes native Storage</a></li>
                    <li><a href="/products#kadalu-storage">Kadalu Storage</a></li>
                    <li><a href="/products#glusterup">GlusterFS monitoring</a></li>
                    <li><a href="/services">Services</a></li>
                    <li><a href="/services#features">Feature development</a></li>
                    <li><a href="/services#upgrade">Upgrade assistance</a></li>
                    <li><a href="/services#consultancy">Consultancy</a></li>
                    <li><a href="/security">Security</a></li>
                </ul>
            </div>

            <div class="mb-10">
                <h2 class="text-xl font-semibold text-indigo-300">Community</h2>
                <ul>
                    <li><a href="/opensource">Open Source</a></li>
                    <li><a href="https://join.slack.com/t/kadalu/shared_invite/enQtNzg1ODQ0MDA5NTM2LWMzMTc5ZTJmMjk4MzI0YWVhOGFlZTJjZjY5MDNkZWI0Y2VjMDBlNzVkZmI1NWViN2U3MDNlNDJhNjE5OTBlOGU">Slack</a></li>
                    <li><a href="https://github.com/kadalu">Github</a></li>
                    <!-- <li><a href="/office-hours">Office Hours</a></li> -->
                </ul>
            </div>

            <div class="mb-10">
                <h2 class="text-xl font-semibold text-indigo-300">Learn</h2>
                <ul>
                    <li><a href="/docs">Documentation</a></li>
                    <li><a href="/blog">Blog</a></li>
                    <li><a href="/faq">FAQ</a></li>
                    <li><a href="/rfcs">RFCs</a></li>
                    <!-- <li><a href="/compare">Compare</a></li> -->
                </ul>
            </div>

            <div class="mb-10">
                <h2 class="text-xl font-semibold text-indigo-300">Company</h2>
                <ul>
                    <li><a href="/company">About</a></li>
                    <li><a href="/contact">Contact</a></li>
                    <li><a href="/sitemap.xml">Sitemap</a></li>
                </ul>

                <h2 class="text-xl font-semibold text-indigo-300 mt-10">Write to us</h2>
                <ul>
                    <li><a href="mailto:hello@kadalu.io"><svg class="w-4 h-4 inline-block mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path></svg>hello@kadalu.io</a></li>
                </ul>

                <h2 class="text-xl font-semibold text-indigo-300 mt-10">Follow Us</h2>
                <ul>
                    <li><a href="https://twitter.com/kadaluio">Twitter</a></li>
                    <li><a href="https://linkedin.com/company/kadalu-io">Linkedin</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>
<div class="bg-gray-800 text-gray-100 py-10">
    <div class="mx-auto w-3/4 text-center text-gray-300 mb-10">
        &copy; 2022 Kadalu Software Private Limited. All Rights Reserved.
    </div>
</div>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-144588868-2"></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-144588868-2');
</script>


    </body>
</html>
