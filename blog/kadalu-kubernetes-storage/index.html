<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="utf-8">
        
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Kadalu Kubernetes(k8s) Storage | Kadalu </title>
<link href="/static/css/fav.png" rel="icon" type="image/x-icon" />
<link rel="apple-touch-icon" href="/static/css/fav.png" />
<meta name="generator" content="Nanoc 4.12.1">
<meta property="og:title" content="Kadalu Kubernetes(k8s) Storage"/>
<meta name="author" content="aravindavk"/>
<meta property="og:locale" content="en_US"/>
<meta name="description" content="Kadalu project offers a lightweight persistent storage solution for applications running in Kubernetes. Kadalu k8s storage solution is lightest among all the other k8s integrations using Gluster because Kadalu is integrated natively with Kubernetes without using Gluster's management daemon. With this many layers are reduced and completely isolated processes related to different storage devices."/>
<meta property="og:description" content="Kadalu project offers a lightweight persistent storage solution for applications running in Kubernetes. Kadalu k8s storage solution is lightest among all the other k8s integrations using Gluster because Kadalu is integrated natively with Kubernetes without using Gluster's management daemon. With this many layers are reduced and completely isolated processes related to different storage devices."/>
<link rel="canonical" href="/blog/kadalu-kubernetes-storage/"/>
<meta property="og:url" content="/blog/kadalu-kubernetes-storage/"/>
<meta property="og:site_name" content="Kadalu"/>
<meta property="og:image" content="/static/images/use-kadalu.jpeg"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2020-01-15"/>
<meta name="twitter:card" content="summary_large_image"/>
<meta property="twitter:image" content="/static/images/use-kadalu.jpeg"/>
<meta property="twitter:title" content="Kadalu Kubernetes(k8s) Storage"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <link rel="stylesheet" href="/static/css/stylesheet.css">
<link rel="stylesheet" href="/static/css/syntax-highlight-emacs.css">
<script defer data-domain="kadalu.io" src="https://plausible.io/js/plausible.js"></script>
<script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.8.2/dist/alpine.min.js" defer></script>

    </head>
    <body>
        

<div class="bg-indigo-900">
    <div class="w-full px-5 px-10 md:w-3/4 md:px-0 m-auto py-5">
        <div class="lg:grid lg:grid-cols-12" x-data="{ menuOpen : false }">
            <div class="col-span-4 lg:col-span-2" style="height:40px">
                <a href="/"><img src="/static/css/logo.png" class="h-10 float-left" /></a>
                <button @click="menuOpen = !menuOpen" class="block absolute md:hidden right-7 top-5 w-8 h-8 text-gray-200 p-1">
                    <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
                </button>
            </div>
            <div class="pt-2 col-span-8 lg:col-span-10">
                <nav class="absolute md:relative top-16 left-0 md:top-0 z-20 md:flex flex-col-reverse md:flex-row-reverse md:space-x-3 font-semibold w-full md:w-auto bg-indigo-900 shadow-md rounded-lg md:rounded-none md:shadow-none md:bg-transparent p-6 pt-5 md:p-0"
                     :class="{ 'flex' : menuOpen , 'hidden' : !menuOpen}"  @click.away="menuOpen = false"
                >
                    <a href="/blog" class="bg-gray-900 text-white py-2 px-3 rounded-md text-sm font-medium">Blog</a>
                    <a href="/company" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Company</a>
                    <a href="/opensource" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Open Source</a>
                    <a href="/services" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Services</a>
                    <a href="/products" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Products</a>
                    <a href="/docs" class="text-gray-300 hover:bg-gray-700 hover:text-white py-4 md:py-2 px-3 rounded-md text-sm font-medium">Docs</a>
                </nav>
            </div>
        </div>
    </div>
</div>

        <div class="py-10">
            <div id="main" class="mx-auto w-full px-10 md:w-3/4 md:px-0 mb-10">
                <div class="grid grid-cols-12 gap-4">
                    <div class="col-span-9 prose max-w-none prose-indigo">
                        <h1>Kadalu Kubernetes(k8s) Storage</h1>
                        
                        
                        <div class="text-gray-500 text-sm mb-1">Posted on <strong>Jan 15, 2020</strong> by <strong>Aravinda Vishwanathapura</strong></div>
                        <div class="text-gray-600 text-sm mb-7">
                            <svg class="w-6 h-6 inline-block mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path></svg>
                            6 minutes read.
                        </div>
                        <div class="paragraph">
<p>Containers on restart don&#8217;t persist the modifications done while
running.  The applications which need persistent storage can use a
directory from the host machine as volume, request for persistent
local volume, or third-party storage providers while running in
<a href="https://kubernetes.io/">Kubernetes(k8s)</a>.</p>
</div>
<div class="paragraph">
<p>For example, to run an Nginx static file server in a container, files
need to be copied to <code>/usr/share/nginx/html</code> directory. But on
container restart, the data saved in that directory is lost. A
directory from the host machine can be mapped as
<code>/usr/share/nginx/html</code> inside the container using the
<a href="https://kubernetes.io/docs/concepts/storage/volumes/#hostpath">hostPath</a>
configuration.</p>
</div>
<div class="paragraph">
<p>Take another example; the user runs AI/ML tools on a set of data and
saves the result in the output directory. If the data in input and
output directories are not persistent, then all the processed data
will be lost on the container restart.</p>
</div>
<div class="paragraph">
<p>HostPath and Local PV solves most of the use cases, but what happens
if an application scheduled to run in another node if the node in
which the app was previously running goes down?</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="https://kadalu.io"><img src="/static/images/use-kadalu.jpeg" alt="Use Kadalu!"></a>
</div>
</div>
<div class="paragraph">
<p>Kubernetes takes care of scheduling the app pod to run in another node
if the currently running node goes down. But copying data associated
with the application to the new node is not feasible.</p>
</div>
<div class="sect1">
<h2 id="_how_kadalu_solve_the_persistent_storage_problem">How Kadalu solve the persistent storage problem?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Kadalu project offers a lightweight persistent storage solution for
applications running in Kubernetes. Kadalu k8s storage solution is
lightest among all the other k8s integrations using
<a href="https://www.gluster.org">Gluster</a> because Kadalu is integrated natively
with Kubernetes without using Gluster&#8217;s management daemon. With this
design pattern, many layers are reduced and completely isolated the
processes related to different storage devices.</p>
</div>
<div class="paragraph">
<p>Kadalu is cluster-aware and capable of providing mount over the
network. It uses GlusterFS to provide storage to application pods.</p>
</div>
<div class="paragraph">
<p>Kadalu accepts raw device as its storage and can provide multiple
small persistent volumes from that storage. For example, From <code>1TiB</code>
device, Kadalu can provide <code>1000</code> persistent volumes of <code>1GiB</code> each.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_components">Components</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_kadalu_operator_pod">Kadalu Operator Pod</h3>
<div class="paragraph">
<p>Kadalu Operator is just like any other pod but with special
permissions. The Operator starts CSI pods when it began and watches
for any new storage device configuration. For every new storage
configuration, the Operator starts the required server pods. The
Operator is also responsible for maintaining the health of the Kadalu
cluster.</p>
</div>
</div>
<div class="sect2">
<h3 id="_kadalu_csi_pods">Kadalu CSI Pods</h3>
<div class="paragraph">
<p>Kubernetes defines <a href="https://kubernetes.io/blog/2019/01/15/container-storage-interface-ga/">Container Storage Interface</a>,
a standard protocol to communicate between the application and
different storage providers. For example, the user submits a claim for
persistent volume, Kubernetes will route the request to respective CSI
driver registered. In this case, Kadalu CSI drivers are running as
pods and listening to the persistent Volume claim requests. Kadalu CSI
drivers are responsible for preparing the volume and make it available
when the requester pod starts.</p>
</div>
</div>
<div class="sect2">
<h3 id="_kadalu_server_pods">Kadalu Server Pods</h3>
<div class="paragraph">
<p>These pods are important ones. One pod will run for every storage
device added. These pods take care of exporting storage and managing
quota.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation">Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Install Kadalu Operator using the following command. Once the Operator
pod starts it automatically starts the required CSI driver pods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>kubectl create <span class="nt">-f</span> https://kadalu.io/operator-latest.yaml</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_add_storage_devices_to_kadalu">Add storage devices to Kadalu</h3>
<div class="paragraph">
<p><a href="https://kadalu.io/blog/introducing-kadalu-kubectl-plugin">Kadalu Kubectl plugin</a> is
available with the release 0.4, install it using Python <code>pip3 install
kubectl-kadalu</code> command. For example, if a device <code>/dev/vdc</code> needs to
be exported from the node kube-node-1.example.com then run the
following command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>kubectl kadalu storage-add storage-pool-1 <span class="nt">--type</span><span class="o">=</span>Replica1 <span class="se">\</span>
    <span class="nt">--device</span> kube-node1.example.com:/dev/vdc</code></pre>
</div>
</div>
<div class="paragraph">
<p>Currently supported types are "Replica1" and "Replica3". More details
about these configurations are discussed later in this blog post.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>kubectl get pods <span class="nt">-n</span> kadalu
<span class="go">NAME                                        READY   STATUS    RESTARTS   AGE
csi-nodeplugin-5hfms                        3/3     Running   0          14m
csi-nodeplugin-924cc                        3/3     Running   0          14m
csi-nodeplugin-cbjl9                        3/3     Running   0          14m
csi-provisioner-0                           4/4     Running   0          14m
operator-577f569dc8-l2q6c                   1/1     Running   0          15m
server-storage-pool-1-0-kube-node1...-0     2/2     Running   0          11m</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s it! Now we are ready to claim persistent Volumes.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_webserver_example">Running Webserver example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create a Persistent Volume Claim(PVC) as below,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># File: webserver-pvc.yaml</span>
<span class="nn">---</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PersistentVolumeClaim</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">webapp-pv</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">storageClassName</span><span class="pi">:</span> <span class="s">kadalu.replica1</span>
  <span class="na">accessModes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">ReadWriteMany</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">requests</span><span class="pi">:</span>
      <span class="na">storage</span><span class="pi">:</span> <span class="s">1GiB</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>kubectl create <span class="nt">-f</span> webserver-pvc.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now deploy an Nginx pod by specifying the PVC name created above.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># File: webserver-app.yaml</span>
<span class="nn">---</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">webapp</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">web-nginx</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:alpine</span>
      <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">80</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">http-server"</span>
      <span class="na">volumeMounts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/usr/share/nginx/html</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">webapp-storage</span>
  <span class="na">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">webapp-storage</span>
      <span class="na">persistentVolumeClaim</span><span class="pi">:</span>
       <span class="na">claimName</span><span class="pi">:</span> <span class="s">webapp-pv</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>kubectl create <span class="nt">-f</span> webserver-app.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Documentation for this use-case is available <a href="https://kadalu.io/docs/k8s-storage/latest/running-a-webserver">here</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kadalu_configurations">Kadalu Configurations</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_kadalu_configuration_replica1">Kadalu configuration - Replica1</h3>
<div class="paragraph">
<p>This configuration provides high availability for applications if the
storage node is up. This configuration is still better than using
hostPath but not so useful when the storage node goes down.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>kubectl kadalu storage-add storage-pool-1 <span class="nt">--type</span><span class="o">=</span>Replica1 <span class="se">\</span>
    <span class="nt">--device</span> kube-node1.example.com:/dev/vdc</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kadalu_configuration_replica1_but_storage_from_another_storage_provider">Kadalu configuration - Replica1 but storage from another storage provider</h3>
<div class="paragraph">
<p>Claim large block devices from Azure or AWS and multiplex into
multiple RWX/RWO volumes using Kadalu Replica1 config. In this case,
AWS/Azure will take care of storage availability.</p>
</div>
<div class="paragraph">
<p>This solution is better compared to the previous solution because
Kubernetes will now take care of scheduling Kadalu server pod wherever
AWS/Azure devices move in the cluster.</p>
</div>
<div class="paragraph">
<p>There will be downtime of application pods till the AWS/Azure storage
mounts in another node, and the Kadalu storage server starts in that
new node.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>kubectl kadalu storage-add storage-pool-1 <span class="nt">--type</span><span class="o">=</span>Replica1 <span class="se">\</span>
    <span class="nt">--pvc</span> azure-vol-1</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kadalu_configuration_replica3">Kadalu Configuration - Replica3</h3>
<div class="paragraph">
<p>This solution provides high availability of storage even if one out of
three nodes goes down.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>kubectl kadalu storage-add storage-pool-1 <span class="nt">--type</span><span class="o">=</span>Replica3 <span class="se">\</span>
    <span class="nt">--device</span> kube-node1.example.com:/dev/vdc <span class="se">\</span>
    <span class="nt">--device</span> kube-node2.example.com:/dev/vdc <span class="se">\</span>
    <span class="nt">--device</span> kube-node3.example.com:/dev/vdc</code></pre>
</div>
</div>
<div class="paragraph">
<p>Kadalu is also capable of providing persistent storage from Externally
managed Gluster
cluster. <a href="https://kadalu.io/blog/kadalu-cattle-mode-for-storage">Amar</a>
mentioned those configurations in his blog. We will write about it in
detail with the 0.5 release(Expected at the end of this month).</p>
</div>
<div class="paragraph">
<p>Is Kadalu suitable for your use-case? Please try and let us know.</p>
</div>
</div>
</div>
</div>
                        <p class="bg-blue-200 px-2 py-2 mb-10 rounded">Join the Kadalu team as we plan, design and develop new features. We are available on our Slack instance, <a href="https://join.slack.com/t/kadalu/shared_invite/enQtNzg1ODQ0MDA5NTM2LWMzMTc5ZTJmMjk4MzI0YWVhOGFlZTJjZjY5MDNkZWI0Y2VjMDBlNzVkZmI1NWViN2U3MDNlNDJhNjE5OTBlOGU">https://kadalu.slack.com</a>.</p>
                    </div>
                    <div class="col-span-3">
                        <div class="mt-20 text-center">
                            <img class="rounded-full mb-5 mx-auto" style="width:150px;height:150px" src="https://github.com/aravindavk.png?size=300px"/>
                            <h2 class="font-semibold text-center">Aravinda Vishwanathapura</h2>
                            
                            <p>Kadalu Maintainer</p>
                            
                            <p>
                                
                                <a class="mr-2 text-indigo-600" href="https://aravindavk.in">Website</a>|
                                
                                
                                <a class="mx-2 text-indigo-600" href="https://twitter.com/aravindavk">Twitter</a>|
                                
                                <a class="ml-2 text-indigo-600" href="https://github.com/aravindavk">Github</a>
                            </p>
                        </div>
                    </div>
            </div>
        </div>
        <div class="bg-gray-800 text-gray-100 py-10">
    <div class="mx-auto w-full px-5 px-10 md:w-3/4 md:px-0" style="min-height: 40vh">
        <div class="md:grid gap-2 md:grid-cols-4 md:gap-4">
            <div class="mb-10">
                <h2 class="text-xl font-semibold text-indigo-300">Kadalu</h2>
                <ul>
                    <li><a href="/products#k8s-native-storage">Kubernetes native Storage</a></li>
                    <li><a href="/products#kadalu-storage">Kadalu Storage</a></li>
                    <li><a href="/products#glusterup">GlusterFS monitoring</a></li>
                    <li><a href="/services">Services</a></li>
                    <li><a href="/services#features">Feature development</a></li>
                    <li><a href="/services#upgrade">Upgrade assistance</a></li>
                    <li><a href="/services#consultancy">Consultancy</a></li>
                    <li><a href="/security">Security</a></li>
                </ul>
            </div>

            <div class="mb-10">
                <h2 class="text-xl font-semibold text-indigo-300">Community</h2>
                <ul>
                    <li><a href="/opensource">Open Source</a></li>
                    <li><a href="https://join.slack.com/t/kadalu/shared_invite/enQtNzg1ODQ0MDA5NTM2LWMzMTc5ZTJmMjk4MzI0YWVhOGFlZTJjZjY5MDNkZWI0Y2VjMDBlNzVkZmI1NWViN2U3MDNlNDJhNjE5OTBlOGU">Slack</a></li>
                    <li><a href="https://github.com/kadalu">Github</a></li>
                    <!-- <li><a href="/office-hours">Office Hours</a></li> -->
                </ul>
            </div>

            <div class="mb-10">
                <h2 class="text-xl font-semibold text-indigo-300">Learn</h2>
                <ul>
                    <li><a href="/docs">Documentation</a></li>
                    <li><a href="/blog">Blog</a></li>
                    <li><a href="/faq">FAQ</a></li>
                    <li><a href="/rfcs">RFCs</a></li>
                    <!-- <li><a href="/compare">Compare</a></li> -->
                </ul>
            </div>

            <div class="mb-10">
                <h2 class="text-xl font-semibold text-indigo-300">Company</h2>
                <ul>
                    <li><a href="/company">About</a></li>
                    <li><a href="/contact">Contact</a></li>
                    <li><a href="/sitemap.xml">Sitemap</a></li>
                </ul>

                <h2 class="text-xl font-semibold text-indigo-300 mt-10">Write to us</h2>
                <ul>
                    <li><a href="mailto:hello@kadalu.io"><svg class="w-4 h-4 inline-block mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path></svg>hello@kadalu.io</a></li>
                </ul>

                <h2 class="text-xl font-semibold text-indigo-300 mt-10">Follow Us</h2>
                <ul>
                    <li><a href="https://twitter.com/kadaluio">Twitter</a></li>
                    <li><a href="https://linkedin.com/company/kadalu-io">Linkedin</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>
<div class="bg-gray-800 text-gray-100 py-10">
    <div class="mx-auto w-3/4 text-center text-gray-300 mb-10">
        &copy; 2022 Kadalu Software Private Limited. All Rights Reserved.
    </div>
</div>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-144588868-2"></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-144588868-2');
</script>


    </body>
</html>
